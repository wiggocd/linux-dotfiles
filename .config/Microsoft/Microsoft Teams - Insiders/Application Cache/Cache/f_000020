webpackJsonp([20],{2218:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(2219),n(2221),n(2228)},2219:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(2220),i=function(){function e(e,t,n,a,i,s,r,o,p,l,c,d,g,u,h,m,y,f,A){this.$q=e,this.$timeout=t,this.$filter=n,this.$translate=a,this.constants=i,this.resources=s,this.appsService=r,this.appStateAdapter=o,this.dialogService=p,this.extensionManifestService=l,this.navigationService=c,this.loggingService=d,this.routeUtilityService=g,this.tooltipService=u,this.peopleSlugService=h,this.utilityService=f,this.eventingService=A,this.errorInfo="",this.currentIndex=0,this.isGuestUser=!1,this.fileSelectionTimeoutInMS=18e4,this.logger=d.newLogger("ChatAppsList"),this.uploadACustomApp=a.instant(s.strings.chats_apps_sideload_app_button_label),this.enableInstallChatAppsFromStore=m.valueAsBoolean(i.settings.names.enableInstallChatAppsFromStore),this.enableSideloadAppByZip=m.valueAsBoolean(i.settings.names.enableSideloadAppByZip),this.isGuestUser=y.isGuestUserType(),this.sortAppsList(),this.setFileSelecting(!1)}return e.$inject=["$q","$timeout","$filter","$translate","constants","resources","appsService","appStateAdapter","dialogService","extensionManifestService","navigationService","loggingService","routeUtilityService","tooltipService","peopleSlugService","settingsService","identityService","utilityService","eventingService"],e.prototype.onSideloadAppButtonClicked=function(){var e=this;this.setFileSelecting(!0),this.fileSelectionTimeoutPromise&&(this.$timeout.cancel(this.fileSelectionTimeoutPromise),this.fileSelectionTimeoutPromise=void 0),this.fileSelectionTimeoutPromise=this.$timeout(function(){e.dismissChatAppPopover()},this.fileSelectionTimeoutInMS)},e.prototype.manageApps=function(){this.dismissChatAppPopover(),this.chatId=this.getChatId(),this.navigationService.navigateToManageAppsInChat(this.chatId,"chat-apps-list")},e.prototype.openAppDetails=function(e){this.dismissChatAppPopover();var t=this.appItems[e];this.chatId=this.getChatId();var n={appID:t.id,intent:teamspace.components.AddAppDialogIntent.GroupChat,chatId:this.chatId,preselectChat:this.chatId,action:teamspace.components.AddAppDialogAction.View,autoNavigationOnDone:!0,source:"chat-apps-list"};this.dialogService.openLazyDialog(this.constants.lazyDialogs.addAppNew,this.constants.lazyModules.extensibilityDialogs,n)},e.prototype.atMentionBot=function(e){var t=this,n=this.appItems[e],a=this.logger.service.newScenario(this.constants.scenarios.extensibility.apps.chat.getGroupChatAppDefinition);this.dismissChatAppPopover(),this.appsService.getGroupChatAppDefinition(this.getChatId(),n.id,"chat-apps-list").then(function(e){if(e&&e.bots&&e.bots.length>0){var i={botProfile:{memberCount:0,accountEnabled:!0,displayName:n.name,mri:t.constants.bots.keyPrefix+e.bots[0].id,type:t.constants.atMentions.type.bot},type:t.constants.atMentions.type.bot};t.eventingService.$emit(t.constants.events.bots.insertBotAtMention,i)}a.stop()}).catch(function(e){a.fail({error:e})})},e.prototype.sideloadApp=function(e){var t=this;if(e){this.setFileSelecting(!1),this.fileSelectionTimeoutPromise&&(this.$timeout.cancel(this.fileSelectionTimeoutPromise),this.fileSelectionTimeoutPromise=void 0);var n=this.logger.service.newScenario(this.constants.scenarios.extensibility.apps.chat.processSideloadedManifest);this.loggingService.info("Processing uploaded app definition"),this.errorInfo=null,this.chatId=this.getChatId(),this.dismissChatAppPopover(),this.setAppIsUploading(!0);var a="",i=this.enableSideloadAppByZip?this.extensionManifestService.getZipStreamPromise(e):this.$q.resolve();this.$q.all([this.extensionManifestService.extractAppDefinition(e,this.enableSideloadAppByZip),this.appsService.getInstalledAppsForGroupChat(this.chatId),i]).then(function(e){var n=e[0],i=e[1],s=e[2];a=n.name;for(var r=0;r<i.length;r++){var o=i[r];if(teamspace.services.AppsServiceUtils.isAppInstalled(o)&&n.externalId===o.appDefinition.externalId)return n.id=o.appDefinition.id,t.enableSideloadAppByZip?t.appsService.updateGroupChatAppDefinitionFromZip(t.chatId,o.appDefinition.id,s):t.appsService.updateGroupChatAppDefinition(t.chatId,n)}return t.enableSideloadAppByZip?t.appsService.createGroupChatAppDefinitionFromZip(t.chatId,s):t.appsService.createGroupChatAppDefinition(t.chatId,n)}).then(function(){n.stop(),t.showBanner(t.$translate.instant(t.resources.strings.chats_apps_sideload_app_installtion_banner,{name:a}),"chat-add-app")}).catch(function(e){e.type===t.constants.extensibility.apps.errorCodes.manifestError?(n.cancel({error:e.errors}),t.handleError(e.errors,"Failed to validate app manifest")):e.data&&e.data.errorCode===t.constants.extensibility.apps.errorCodes.unableToParseTeamsAppManifest?(n.cancel({error:e}),t.handleManifestParseError(e.data.message)):(n.fail({error:e}),t.handleError(e,"Failed to upload app package"))}).finally(function(){n.stop(),t.buildAppsList(),t.setAppIsUploading(!1)})}},e.prototype.deleteApp=function(e,t){var n=this,a=this.appItems[t];if(a){var i={closeButtonText:this.$translate.instant(this.resources.strings.extension_uninstallConfirmCloseText),okButtonText:this.$translate.instant(this.resources.strings.extension_uninstallConfirmOkText),confirmMessageTitle:this.$translate.instant(this.resources.strings.extension_uninstallConfirmTitle,{name:a.name}),confirmMessageHtmlBody:this.$translate.instant(this.resources.strings.extension_uninstallConfirmMessage,{name:a.name}),clickSilent:!0,callback:function(){var e=n.logger.service.newScenario(n.constants.scenarios.extensibility.apps.chat.deleteAppFromChatScenario);n.logger.info("Starting deletion of app definition"),n.errorInfo=null,n.setAppIsDeleting(!0),n.appItems.splice(t,1),n.chatId=n.getChatId(),n.appsService.deleteGroupChatAppEntitlement(n.chatId,a.id).then(function(){e.stop(),n.showBanner(n.$translate.instant(n.resources.strings.chats_apps_sideload_app_remove_banner,{name:a.name}),"chat-remove-app")}).catch(function(t){n.buildAppsList(),e.fail(),t&&t.type===n.constants.extensibility.apps.errorCodes.amsError?n.handleError(t,"Failed to remove image from ams, appId: "+a.id):n.handleError(t,"Failed to uninstall app, appId: "+a.id)}).finally(function(){e.stop(),n.setAppIsDeleting(!1)})}};this.dialogService.open(this.constants.dialogs.confirmDialog,i)}},e.prototype.handleError=function(e,t){var n=t+". Error: ";"string"==typeof e?(n+=e,this.errorInfo=this.$translate.instant(this.resources.strings.chats_apps_sideload_app_manifest_error)):(n+=JSON.stringify(e),this.errorInfo=this.$translate.instant(this.resources.strings.chats_apps_sideload_app_error)),this.showBanner(this.errorInfo,"chat-sideload-app_error"),this.logger.error(n)},e.prototype.handleManifestParseError=function(e){this.dialogService.openLazyDialog(this.constants.lazyDialogs.manifestError,this.constants.lazyModules.extensibilityDialogs,{errorMessage:this.$translate.instant(this.resources.strings.extension_addAppDialogManifestParsingErrorMessage),errorDetails:e})},e.prototype.dismissChatAppPopover=function(){this.tooltipService.clearTooltip(teamspace.services.TooltipType.Popover,"chat-apps-popover")},e.prototype.handleKeyDown=function(e){e.which===this.constants.keyCodes.down?(e.preventDefault(),this.currentIndex=this.currentIndex>=this.appItems.length?0:this.currentIndex+1):e.which===this.constants.keyCodes.up&&(e.preventDefault(),this.currentIndex=this.currentIndex>0?this.currentIndex-1:this.appItems.length)},e.prototype.hoverRow=function(e){this.currentIndex=e},e.prototype.buildAppsList=function(){var e=this;this.setAppIsLoading(!0),this.getChatAppsFromAppsService().then(function(t){e.appItems=t,e.sortAppsList(),e.setAppItemsChange(t)}).catch(function(t){e.handleError(t,"Failed to get the apps list")}).finally(function(){e.setAppIsLoading(!1)})},e.prototype.sortAppsList=function(){this.appItems=this.$filter("orderBy")(this.appItems,"name")},e.prototype.getChatAppsFromAppsService=function(){var e=this;return this.chatId=this.getChatId(),this.appsService.getInstalledAppsForGroupChat(this.chatId).then(function(t){if(!t||t.length<1)return[];for(var n=[],a=0;a<t.length;a++){var i=t[a];if(teamspace.services.AppsServiceUtils.isAppInstalled(i)&&!teamspace.services.AppsServiceUtils.isAppPermanentForDiscoverability(i)){var s=i.appDefinition.name;e.appsService.isSideloadedApp(i.appDefinition)&&(s=e.$translate.instant(e.resources.strings.chats_apps_sideload_app_name,{name:s})),n.push({id:i.appDefinition.id,name:s,description:i.appDefinition.longDescription,icon:i.appDefinition.largeImageUrl,smallIcon:i.appDefinition.smallImageUrl,accentColor:i.appDefinition.accentColor,hasBots:!!i.appDefinition.bots,hasTabs:!!i.appDefinition.galleryTabs,externalId:i.appDefinition.externalId})}}return n})},e.prototype.getChatId=function(){var e=this.routeUtilityService.getRootRouteParams();if(e.peopleSlug&&e.ctx===this.constants.navigation.context.chat){var t=this.peopleSlugService.resolve(e.peopleSlug);return t&&t.conversation&&t.conversation.id}return null},e.prototype.setAppItemsChange=function(e){this.onAppItemsChange&&this.onAppItemsChange({apps:e})},e.prototype.setFileSelecting=function(e){this.onFileSelecting&&this.onFileSelecting({isSelecting:e})},e.prototype.setAppIsUploading=function(e){this.onAppUploading&&this.onAppUploading({isUploading:e})},e.prototype.setAppIsDeleting=function(e){this.onAppDeleting&&this.onAppDeleting({isDeleting:e})},e.prototype.setAppIsLoading=function(e){this.onAppLoading&&this.onAppLoading({isLoading:e})},e.prototype.showBanner=function(e,t){this.appStateAdapter.mainNotificationBannerStore.showBanner(teamspace.services.Severity.Warning,e,t,{countdownInSeconds:2.5,autoHideTimer:2.5})},e}();t.ChatAppsListController=i,angular.module("teamspace.chatAppsList",[]).directive("chatAppsList",function(){return{restrict:"E",scope:{},bindToController:{appItems:"=",onAppItemsChange:"&",onAppUploading:"&",onAppDeleting:"&",onAppLoading:"&",onFileSelecting:"&"},templateUrl:"components/extensibility/chat-apps-list/chat-apps-list.html",controller:i,controllerAs:"chatAppsList"}}).run(["$templateCache",function(e){e.put("components/extensibility/chat-apps-list/chat-apps-list.html",a)}])},2220:function(e,t){e.exports='<nav class="chat-apps-list" acc-role="dialog">\n  <div class="simple-scrollbar" ng-if="chatAppsList.appItems && chatAppsList.appItems.length > 0" simple-scrollbar>\n    <ul class="chat-apps" acc-role="menu">\n      <li ng-repeat="app in chatAppsList.appItems track by $index" acc-role="menu-item focus-default" class="app-item">\n        <a class="ts-sym app-button" ng-click="chatAppsList.enableInstallChatAppsFromStore && chatAppsList.atMentionBot($index)" ng-class="{ \'ts-selectedRow\': $index == chatAppsList.currentIndex}" ng-keydown="chatAppsList.handleKeyDown($event)" ng-mouseenter="chatAppsList.hoverRow($index)" track-gesture="{{::$root.trackConstants.trackGesture.click}}" track-scenario="{{::$root.trackConstants.trackScenario.navBotHeader}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.appDetails}}" track-outcome="{{::$root.trackConstants.trackOutcome.atMention}}" track-name="{{::$root.trackConstants.trackModuleName.chatBotHeader}}" track-type="{{::$root.trackConstants.trackType.chatBotHeader}}" track-summary="Chat Header bot list">\n          <ng-include class="app-icon" src="app.icon" ng-if="::chatAppsList.utilityService.useNgIncludeForIcon(app.icon)"></ng-include>\n          <img class="app-icon" ng-src="{{::app.icon}}" ng-if="::!chatAppsList.utilityService.useNgIncludeForIcon(app.icon)"/>\n          <span class="app-name single-line-truncation" title="{{app.name}}">{{app.name}}</span>\n          <button class="ts-sym show-icon-on-hover" ng-if="::(!chatAppsList.enableInstallChatAppsFromStore && !chatAppsList.isGuestUser)" ng-click="chatAppsList.deleteApp($event, $index)" space-action>\n            <ng-include src="\'svg/icons-delete.html\'"></ng-include>\n          </button>\n        </a>\n      </li>\n      <li class="chat-sideload-apps" ng-if="::(!chatAppsList.enableInstallChatAppsFromStore && !chatAppsList.isGuestUser)">\n        <button class="ts-sym chat-sideload-apps-button" acc-role="menu-item focus-default" ngf-select="chatAppsList.sideloadApp($file)" ng-model="chatAppsList.file" ngf-pattern="\'.zip\'" ngf-accept="\'.zip\'" track-click-silent="true" ng-click="chatAppsList.onSideloadAppButtonClicked()" data-tid="td-sideload-app" ng-mouseenter="chatAppsList.hoverRow(-1)" ng-keydown="chatAppsList.handleKeyDown($event)">\n          <ng-include src="\'svg/icons-files-upload.html\'"></ng-include>\n          <span class="chat-sideload-apps-text" ng-bind="::chatAppsList.uploadACustomApp"></span>\n        </button>\n      </li>\n      <li class="chat-sideload-apps" ng-if="::chatAppsList.enableInstallChatAppsFromStore" acc-role="menu-item focus-default">\n        <button class="ts-sym chat-sideload-apps-button" ng-click="chatAppsList.manageApps()" ng-mouseenter="chatAppsList.hoverRow(-1)" ng-keydown="chatAppsList.handleKeyDown($event)" track-gesture="{{::$root.trackConstants.trackGesture.click}}" track-scenario="{{::$root.trackConstants.trackScenario.manageApps}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.appSettings}}" track-outcome="{{::$root.trackConstants.trackOutcome.nav}}" track-name="{{::$root.trackConstants.trackModuleName.chatBotHeader}}" track-type="{{::$root.trackConstants.trackType.chatBotHeader}}" track-summary="Chat header manage apps">\n          <ng-include src="\'svg/icons-settings.html\'"></ng-include>\n          <span class="chat-sideload-apps-text" ng-bind="::$root.resources.strings.chat_see_all_apps | translate"></span>\n        </button>\n      </li>\n    </ul>\n  </div>\n</nav>'},2221:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,i=n(2222),s=n(2223),r=n(2224),o=n(2225),p=n(2226),l=n(2227),c=n(47),d="Personal",g="All",u="Bots",h="Tabs",m="Connectors",y="TopPicks",f="NewApps",A="TenantApps",b="PopularApps",v="InputExtensions",S=250,I=40,C=4,x=".td-apps-gallery-list",w=".td-apps-gallery-app",T=[g,"",A,f,b],k="https://statics.teams.cdn.office.net/evergreen-assets/apps/teams_dev_app_largeimage.png?v=0.1",M="https://go.microsoft.com/fwlink/?linkid=2108436",D={AnalyticsBI:"extensibility_apps_store_category_merged_analyticsbi",HumanResource:"extensibility_apps_store_category_merged_hr",DeveloperIT:"extensibility_apps_store_category_merged_developerit",Education:"extensibility_apps_store_category_merged_education",SocialFun:"extensibility_apps_store_category_merged_socialfun",Productivity:"extensibility_apps_store_category_merged_productivity",SalesSupport:"extensibility_apps_store_category_merged_salessupport",ProjectManagement:"extensibility_apps_store_category_merged_projectmanagement"},L={AnalyticsBI:["Analytics","DataVisualizationAndBI"],HumanResource:["HumanResourcesAndRecruiting"],DeveloperIT:["DeveloperTools","ITAdmin"],Education:["Education"],SocialFun:["ImageAndVideoGalleries","Lifestyle","NewsAndWeather","Social","TravelAndNavigation"],Productivity:["ContentManagement","FilesAndDocuments","Productivity","TrainingAndTutorial","Utilities","Microsoft"],SalesSupport:["CustomerAndContactManagement","CustomerSupport","FinancialManagement","SalesAndMarketing"],ProjectManagement:["Communication","ProjectManagement","WorkflowAndBusinessManagement"]};!function(e){e.Generic="generic",e.FourAppsBanner="fourappsbanner"}(a||(a={}));var P=function(){function e(t,n,a,i,s,r,o,p,l,c,T,k,M,P,G,B,E,$,F,V,N,U,O,R,H,z,q,W,j,Z,J){var K,X=this;this.$q=t,this.$window=n,this.constants=a,this.appStateService=i,this.utilityService=s,this.appsService=r,this.ariaLiveService=o,this.loggingService=p,this.$timeout=l,this.$translate=c,this.resources=T,this.$scope=k,this.helpService=M,this.dialogService=G,this.eventingService=B,this.analyticsService=E,this.extensionManifestService=$,this.deepLinkProvider=F,this.settingsService=V,this.tooltipService=R,this.identityService=H,this.tooltipCssApplicators=z,this.filesAsyncMediaService=q,this.appStateAdapter=W,this.searchString="",this.errorInfo="",this.isLoading=!0,this.categories=[],this.bannerViewModel={},this.lobBannerViewModel={},this.gridViewModel={},this.userCanManageTenantApps=!1,this.networkError=!1,this.offlineImage="https://statics.teams.cdn.office.net/hashedassets/svg/app_offline-a6b74ae.html",this.numberOfAppsToLoadOnScroll=40,this.defaultFirstPageAppCount=20,this.storeCategoryMap={},this.showLobBanner=!1,this.showBannerTemplate=!1,this.isUrl=!1,this.isBackgroundLoaded=!0,this.isLogoLoaded=!0,this.bannerImages={},this.firstPageAppsCount=20,this.bottomAppsCount=8,this.categoryCompletenessMap={},this.curatedAppIds=[],this.bannerTitle="",this.bannerSubtitle1="",this.bannerSubtitle2="",this.bannerBackground="",this.calculateSectionAppNum=function(){if(X.enableNewAppStore){var e=angular.element(x),t=angular.element(w),n=X.enableAppStoreOneRowSection?1:2;if(X.sectionAppNum=C*n,e&&e.length>0&&t&&t.length>0){var a=Math.floor(e[0].clientWidth/t[0].offsetWidth);X.sectionAppNum=1==a?2:a*n}}};var Q=p.newScenario(a.scenarios.extensibility.apps.gallery.view),Y=p.newScenario(a.scenarios.extensibility.apps.gallery.render);this.allApps=[],this.appDefinitions=[],this.featuredAppDefinitions=[],this.appGalleryLeftRailPersonalAppDefinitions=[],this.featuredAppsImageInfo=[],this.appSortingRule=V.valueFor(a.settings.names.appSortingRule),this.showInputExtensionCategory=V.valueAsBoolean(a.settings.names.enableComposeExtensionInAppGallery),this.categoryMapping=D,this.uploadACustomApp=c.instant(T.strings.extensibility_apps_gallery_sideload_app),this.enableTenantOwnedApps=V.valueAsBoolean(a.settings.names.enableTenantOwnedApps),this.enableJITTenantAdminLookup=V.valueAsBoolean(a.settings.names.enableJITTenantAdminLookup),this.enableServiceAdminTenantAppManagement=V.valueAsBoolean(a.settings.names.enableServiceAdminTenantAppManagement),this.enableSideloadAppByZip=V.valueAsBoolean(a.settings.names.enableSideloadAppByZip),this.enableNewAppStore=V.valueAsBoolean(a.settings.names.enableNewAppStore),this.enableNewAppStoreLob=V.valueAsBoolean(a.settings.names.enableNewAppStoreLob),this.enableNewAppStorePopular=V.valueAsBoolean(a.settings.names.enableNewAppStorePopular),this.enableNewAppStoreWhatsNew=V.valueAsBoolean(a.settings.names.enableNewAppStoreWhatsNew),this.enableAppStoreOneRowSection=V.valueFor(a.settings.names.enableAppStoreOneRowSection),this.enableAppsUserOnboarding=V.valueFor(a.settings.names.enableAppsUserOnboarding),this.enableTenantBrandingInStore=V.valueFor(a.settings.names.enableTenantBrandingInStore),this.showPublisherInfoInStore=V.valueFor(a.settings.names.showPublisherInfoInStore),this.uploadATenantApp=c.instant(T.strings.extensibility_apps_gallery_upload_option_tenant),this.appFallbackIcon=a.fallbackImages.appFallbackImage,this.isEnableAppsOverrideList=V.valueAsBoolean(a.settings.names.enableAppsOverrideList),this.enableBannerAppsPoweredByCxcs=V.valueAsBoolean(a.settings.names.enableBannerAppsPoweredByCxcs),this.enableIncrementalScrollForStore=V.valueAsBoolean(a.settings.names.enableIncrementalScrollForStore);var ee=V.valueFor(a.settings.names.storeTenantAppsSectionLabel);this.userLanguage=(J.getLocale()||"").toLowerCase(),this.enableUseStoreApi=V.valueAsBoolean(a.settings.names.enableUseStoreApiInAppsGallery),this.enableLobBanner=V.valueAsBoolean(a.settings.names.enableLobBanner),this.preLoadedCategories=[b,f,d,y],this.storeMapQueryableCategories=[g,u,h,m,v,A,b];for(var te in L)(K=this.storeMapQueryableCategories).push.apply(K,L[te]);if(V.valueAsBoolean(a.settings.names.enableSideloadingEnforcement)){var ne;V.valueAsBoolean(a.settings.names.runningscenariotests)||(ne=p.newScenario(a.scenarios.extensibility.apps.gallery.toggleSideloadEntrypoint)),r.getUserAppPolicy("apps gallery").then(function(e){X.sideloadEnabled=!(!e||!e.isSideloadingAllowed)&&e.isSideloadingAllowed,ne&&ne.stop({sideloadingAllowedByPolicy:e&&void 0!=e.isSideloadingAllowed?e.isSideloadingAllowed:void 0,sideloadingEntrypointIsVisible:X.sideloadEnabled})}).catch(function(e){X.sideloadEnabled=!1,ne&&ne.fail({sideloadingEntrypointIsVisible:X.sideloadEnabled,error:e,error1:e})})}else this.sideloadEnabled=N.getSettingValue(SkypeX.Services.TenantSettingsStorageKey.isSideLoadedAppsEnabled);this.lobTextColor=N.getSettingValue(SkypeX.Services.TenantSettingsStorageKey.lobTextColor),this.lobBackground=N.getSettingValue(SkypeX.Services.TenantSettingsStorageKey.lobBackground),this.lobLogo=N.getSettingValue(SkypeX.Services.TenantSettingsStorageKey.lobLogo),this.lobLogomark=N.getSettingValue(SkypeX.Services.TenantSettingsStorageKey.lobLogomark),this.isBackgroundLoaded=!0,this.enableLobBanner&&this.lobBackground&&(this.isUrl=0==this.lobBackground.indexOf("https://")),this.categories.push({value:g,text:c.instant(T.strings.extensibility_apps_gallery_all_apps),title:c.instant(T.strings.extensibility_apps_gallery_all_apps)}),this.categories.push({value:d,text:c.instant(T.strings.extensibility_apps_gallery_personal_apps),title:c.instant(T.strings.extensibility_apps_gallery_personal_apps)}),this.categories.push({value:u,text:c.instant(T.strings.extensibility_apps_gallery_bots_option),title:c.instant(T.strings.extensibility_apps_gallery_title_bots_option)}),this.categories.push({value:h,text:c.instant(T.strings.extensibility_apps_gallery_tabs_option),title:c.instant(T.strings.extensibility_apps_gallery_title_tabs_option)}),this.categories.push({value:m,text:c.instant(T.strings.extensibility_apps_gallery_connectors_option),title:c.instant(T.strings.extensibility_apps_gallery_title_connectors_option)}),this.showInputExtensionCategory&&this.categories.push({value:v,text:c.instant(T.strings.extensibility_apps_messaging_option),title:c.instant(T.strings.extensibility_apps_messaging_option)}),this.dialogTitle=T.strings.extensibility_apps_gallery_title_new,this.intent=this.params.intent?parseInt(this.params.intent):this.intent,this.preselectTeam=this.params.preselectTeam,this.autoNavigationOnDone="true"===this.params.autoNavigationOnDone,this.category=parseInt(this.params.category),this.preselectChat=this.intent===teamspace.components.AddAppDialogIntent.GroupChat?this.params.threadId:void 0,this.galleryCategory="true"===this.params.filterByPersonal?d:teamspace.services.AppsServiceCategoryFilter[parseInt(this.params.category)];var ae=_.find(this.categories,function(e){return e.value===X.galleryCategory});ae&&(this.rightRailRegionLabel=ae.text),this.storeLaunchFromChat=this.params&&"true"===this.params.storeLaunchFromChat,this.bannerViewModel.apps=[],this.getAppRankMapPromise=this.appSortingRule&&!this.enableUseStoreApi?r.getAppStoreRankMap():t.resolve({});var ie=V.valueFor(a.settings.names.appGalleryLeftRailPersonalApps);this.isEnableAppsOverrideList&&(ie=this.parseOverrideList(ie));var se=ie,re=V.valueFor(a.settings.names.appsGalleryNewApps);this.isEnableAppsOverrideList&&(re=this.parseOverrideList(re)),this.storeTenantAppsSectionLabel=this.getTenantAppsSectionNameLabel(ee,null),this.gridViewModel.appDefinitions={},this.gridViewModel.sectionNames={},this.gridViewModel.sectionNames[teamspace.components.GallerySectionFilter.ALL]=c.instant(T.strings.extensibility_apps_gallery_title_all_apps),this.gridViewModel.sectionNames[teamspace.components.GallerySectionFilter.NEW]=c.instant(T.strings.extensibility_apps_gallery_new_apps_option),this.gridViewModel.sectionNames[teamspace.components.GallerySectionFilter.POPULAR]=c.instant(T.strings.extensibility_apps_gallery_popular_apps),this.gridViewModel.isUpdating=this.isUpdating,this.gridViewModel.selectedAppId=this.selectedAppId,this.gridViewModel.isInlineDeleting=this.isInlineDeleting,this.gridViewModel.appFallbackIcon=this.appFallbackIcon,this.gridViewModel.showManageAppOptions=this.showManageAppOptions.bind(this),this.gridViewModel.useNgIncludeForIcon=s.useNgIncludeForIcon,this.gridViewModel.onAppClicked=this.onAppClicked.bind(this),this.gridViewModel.goToSection=this.goToSection.bind(this),this.enableLobBanner&&(this.gridViewModel.lobLogomark=this.lobLogomark),this.skipInstalledSuccess="true"===this.params.skipInstalledSuccess,this.disableSelectCategory=this.category!==teamspace.services.AppsServiceCategoryFilter.All,this.isUserOrAmbiguous=this.intent===teamspace.components.AddAppDialogIntent.User||this.intent===teamspace.components.AddAppDialogIntent.Ambiguous,this.addAppDialogEntryPoint=this.params&&this.params.addAppDialogEntryPoint&&parseInt(this.params.addAppDialogEntryPoint),this.categoryIndexToAddSpace=this.categories.length,this.messageId=this.params.returnMessageId;var oe=this.preselectChannel=this.params.threadId;oe&&this.intent===teamspace.components.AddAppDialogIntent.Team?(this.teamAndChannelPromise=P.resolveTeamAndChannel(oe).then(function(e){X.teamName=e.team&&e.team.displayName}),this.teamId=P.getChannelByObjectId(oe)?P.getChannelByObjectId(oe).parentTeamId:void 0,this.preselectTeam=this.teamId):this.teamAndChannelPromise=t.resolve(),this.categories.push({value:y,text:c.instant(T.strings.extensibility_apps_gallery_featured_option),title:c.instant(T.strings.extensibility_apps_gallery_title_featured_option),hasTopPadding:!0,isHidden:!0}),this.enableNewAppStore&&(this.sectionAppNum=this.enableAppStoreOneRowSection?C:2*C,this.categories.push({value:b,text:c.instant(T.strings.extensibility_apps_gallery_popular_apps),title:c.instant(T.strings.extensibility_apps_gallery_popular_apps)}),this.categories.push({value:f,text:c.instant(T.strings.extensibility_apps_gallery_new_apps_option),title:c.instant(T.strings.extensibility_apps_gallery_new_apps_option)})),this.getAppsPromiseOptions={category:teamspace.services.AppsServiceCategoryFilter.All},this.getInstalledAppsPromise=this.teamId?r.getInstalledAppsForTeam(this.teamId,this.getAppsPromiseOptions):r.getInstalledAppsForUser(this.getAppsPromiseOptions),this.enableUseStoreApi?this.getAppsPromise=t.resolve([]):this.getAppsPromise=this.teamId?r.getTeamAppDefinitions(this.teamId,"td-apps-gallery",this.getAppsPromiseOptions):r.getUserAppDefinitions("td-apps-gallery",this.getAppsPromiseOptions);var pe=null,le=null,ce={all:this.enableNewAppStorePopular?"Alphabetical":"Ranked"},de=this.enableUseStoreApi?r.getAppStoreData("apps gallery","Ranked",ce):t.resolve({});if(this.enableBannerAppsPoweredByCxcs)pe=j.getBannerAppsForStore();else{var ge=V.valueFor(a.settings.names.appsGalleryBannerApps);this.isEnableAppsOverrideList&&(ge=this.parseOverrideList(ge)),pe=t.resolve(ge)}pe.then(function(e){var n,i,s,o=[];X.enableBannerAppsPoweredByCxcs?e?(o=e.appsList,X.populateBannerProps(e)):o=V.valueFor(a.settings.names.appsGalleryBannerApps):o=e,X.bannerViewModel.apps=o,(n=X.curatedAppIds).push.apply(n,_.map(se,function(e){return e.id})),(i=X.curatedAppIds).push.apply(i,_.map(re,function(e){return e.id})),(s=X.curatedAppIds).push.apply(s,_.map(o,function(e){return e.id})),X.curatedAppIds=_.uniq(X.curatedAppIds),le=X.enableUseStoreApi?r.getUserAppDefinitionsListForStore("apps gallery",X.curatedAppIds):t.resolve([])}).then(function(){return de}).then(function(e){if(X.enableUseStoreApi)for(var n in e)e[n]&&(X.storeCategoryMap[n.toLowerCase()]=e[n].appList||[],X.categoryCompletenessMap[n.toLowerCase()]=e[n].isCompleteAppList||!1);t.all([X.getAppsPromise,X.getExtensionGalleryItems(X.category,X.galleryCategory),X.getInstalledAppsPromise,X.getAppRankMapPromise,le]).then(function(e){var n=e[0],i=e[2];X.appRankMap=e[3];var s,r=e[4];s=X.enableUseStoreApi?X.getCategorySetFromStoreCategoryMap(X.storeCategoryMap):X.getCategorySetFromAppDefinitions(n);for(var o=0;o<s.length;o++){var u=s[o];X.categories.push({value:u,text:c.instant(T.strings[X.categoryMapping[u]]),title:c.instant(T.strings[X.categoryMapping[u]])})}if(X.enableTenantOwnedApps){var h=p.newScenario(a.scenarios.extensibility.apps.gallery.loadLOBApps);t.all([O.getTenants(),U.getUserInformation()]).then(function(e){X.currentTenant=_.find(e[0],function(t){return t.tenantId===e[1].profile.tid}),X.currentTenant&&(X.uploadATenantApp=c.instant(T.strings.extensibility_apps_gallery_upload_option_tenant_with_name,{tenantName:X.currentTenant.tenantName}),X.storeTenantAppsSectionLabel=X.getTenantAppsSectionNameLabel(ee,X.currentTenant.tenantName)),X.gridViewModel.sectionNames[teamspace.components.GallerySectionFilter.LOB]=X.storeTenantAppsSectionLabel,X.enableUseStoreApi?A.toLowerCase()in X.storeCategoryMap&&X.insertTenantAppCategory():_.some(n,function(e){return!_.isEmpty(e.tenantId)})&&X.insertTenantAppCategory()}).catch(function(e){p.error("Failed to resolve LOB apps: "+e),h.fail({error:e,error1:e})}).finally(function(){h.stop()})}var m={},f=[],v=[];if(X.enableUseStoreApi){var S={};_.forEach(r,function(e){e&&e.id&&(S[e.id.toLowerCase()]=e)}),_.forEach(se,function(e){var t=e&&e.id?S[e.id.toLowerCase()]:void 0;if(t){var n=X.isInstalledApp(i,t.id);X.appGalleryLeftRailPersonalAppDefinitions.push(X.convertToGalleryViewAppViewModel(t,n))}}),X.enableNewAppStore&&_.forEach(re,function(e){var t=e&&e.id?S[e.id.toLowerCase()]:void 0;if(t){var n=X.isInstalledApp(i,t.id);m[e.id.toLocaleLowerCase()]=X.convertToGalleryViewAppViewModel(t,n)}}),_.forEach(X.bannerViewModel.apps,function(e){var t=e&&e.id?S[e.id.toLowerCase()]:void 0;if(t){var n=X.isInstalledApp(i,t.id);X.featuredAppsImageInfo.push({name:e.name,id:e.id,src:e.src}),X.featuredAppDefinitions.push(X.convertToGalleryViewAppViewModel(t,n))}});var C=X.storeCategoryMap[A.toLowerCase()];_.forEach(C,function(e){if(e&&e.appDefinition){var t=X.isInstalledApp(i,e.appDefinition.id);f.push(X.convertToGalleryViewAppViewModel(e.appDefinition,t,e.ranking))}}),f.sort(X.compareByRanking.bind(X));var x=X.storeCategoryMap[b.toLowerCase()];_.forEach(x,function(e){if(e&&e.appDefinition){var t=X.isInstalledApp(i,e.appDefinition.id);v.push(X.convertToGalleryViewAppViewModel(e.appDefinition,t,e.ranking))}}),v.sort(X.compareByRanking.bind(X))}else _.forEach(n,function(e){if(e){var t=X.isInstalledApp(i,e.id),n=_.find(X.bannerViewModel.apps,function(t){return t&&t.id&&t.id.toLowerCase()===e.id.toLowerCase()}),a=_.find(se,function(t){return t.id.toLowerCase()===e.id.toLowerCase()}),s=X.enableNewAppStore&&e.id?_.find(re,function(t){return t&&t.id&&t.id.toLowerCase()===e.id.toLowerCase()}):null,r=X.enableTenantOwnedApps&&!_.isEmpty(e.tenantId),o=n||s||a||r?X.convertToGalleryViewAppViewModel(e,t):null;n&&(X.featuredAppsImageInfo.push({name:n.name,id:n.id,src:n.src}),X.featuredAppDefinitions.push(o)),a&&X.appGalleryLeftRailPersonalAppDefinitions.push(o),X.enableNewAppStore&&s&&(m[o.id.toLocaleLowerCase()]=o),r&&f.push(o)}});X.featuredAppDefinitions.length&&(_.find(X.categories,function(e){return e.value===y}).isHidden=!1),X.updateBanner(),_.isEmpty(X.appGalleryLeftRailPersonalAppDefinitions)&&(_.remove(X.categories,function(e){return e.value===d}),X.categoryIndexToAddSpace=X.categoryIndexToAddSpace-1,X.galleryCategory===d&&(X.galleryCategory=g)),X.initLoadTimer=l(function(){if(X.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.NEW]=[],re&&re.length&&re.length>0){var e=_.map(re,function(e){return e?m[e.id.toLocaleLowerCase()]:null});e=_.filter(e,function(e){return!!e}),X.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.NEW]=e}X.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.LOB]=f,X.enableUseStoreApi?X.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.POPULAR]=v.slice(0,I):X.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.POPULAR]=X.allApps.slice().sort(X.compare.bind(X)).slice(0,I),X.gridViewModel.increNum=0,X.enableIncrementalScrollForStore?(X.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.ALL]=X.allApps.slice(0,X.bottomAppsCount),X.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.FILTERED]=X.appDefinitions.slice(0,X.firstPageAppsCount)):(X.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.ALL]=X.allApps,X.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.FILTERED]=X.appDefinitions),X.isLoading=!1,X.gridViewModel.isLoadingMoreApps=X.shouldShowScrollLoading(),k.$broadcast("onViewModelDataLoaded"),Y.mark(a.scenarios.extensibility.apps.gallery.finishAppViewModelStep)})})}).catch(function(e){i.isOnline||(X.networkError=!0),Q.fail({error:e,error1:e}),Y.fail({error:e,error1:e}),X.errorInfo="string"==typeof e?e:c.instant(T.strings.td_apps_gallery_error),X.showErrorInfoBanner(X.errorInfo)}).finally(function(){X.updateBanner(),X.updateGrid(!1),Q.stop({numberOfApps:X.appDefinitions?X.appDefinitions.length:"null"}),Y.mark(a.scenarios.extensibility.apps.gallery.finishGettingStoreDataStep),V.valueAsBoolean(a.settings.names.enableRefreshingAppEntitlementsCache)&&B.$emit(a.events.app.checkToRefreshAggEntitlements,"td-apps-gallery")});var ue=_.debounce(function(){return X.calculateAppsDisplayed()},S);this.enableIncrementalScrollForStore&&n.addEventListener("resize",ue),this.enableNewAppStore&&n.addEventListener("resize",this.calculateSectionAppNum),k.$on("onViewModelDataLoaded",function(){X.allPageLoadTimer=l(function(){X.enableNewAppStore&&X.calculateSectionAppNum(),X.enableIncrementalScrollForStore&&X.calculateAppsDisplayed(),X.searchBox=document.getElementById("app-search-input"),X.searchBox&&X.searchBox.focus(),Y.stop({numberOfApps:X.appDefinitions?X.appDefinitions.length:"null",isFirstTimeRender:e.isFirstTimeVisit}),e.isFirstTimeVisit=!1,Z.showPerfIndicators&&B.$emit(a.events.app.galleryReady)})}),k.$on("$destroy",function(e){B.$emit(a.events.app.installed,{result:{installSucceeded:!1}}),Q.cancel(),Y.cancel(),X.initLoadTimer&&l.cancel(X.initLoadTimer),X.allPageLoadTimer&&l.cancel(X.allPageLoadTimer),X.initLoadTimer=null,X.allPageLoadTimer=null,X.filterBySearchDebounce&&X.filterBySearchDebounce.cancel(),ue&&ue.cancel(),X.enableIncrementalScrollForStore&&n.removeEventListener("resize",ue),X.enableNewAppStore&&n.removeEventListener("resize",X.calculateSectionAppNum)}),this.enableTenantOwnedApps&&this.determineTenantAppsAdminStatus(),this.showManageAppButton=this.enableTenantOwnedApps&&this.userCanManageTenantApps&&this.galleryCategory==A,this.filterBySearchDebounce=_.debounce(function(){return X.filterBySearchFunction()},S)}return e.$inject=["$q","$window","constants","appStateService","utilityService","appsService","ariaLiveService","loggingService","$timeout","$translate","resources","$scope","helpService","channelService","dialogService","eventingService","analyticsService","extensionManifestService","deepLinkProvider","settingsService","tenantSettingsStore","authenticationService","tenantService","tooltipService","identityService","tooltipCssApplicators","filesAsyncMediaService","appStateAdapter","cmsService","layoutService","localizationService"],e.prototype.isInstalledApp=function(e,t){var n=_.find(e,function(e){return e&&e.appDefinition&&e.appDefinition.id&&e.appDefinition.id.toLowerCase()===t.toLowerCase()});return!!n&&teamspace.services.AppsServiceUtils.isAppInstalled(n)},e.prototype.sideloadApp=function(e){var t=this;if(e){this.dismissUploadAppPopover();var n=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.gallery.processSideloadedManifest);this.loggingService.info("Processing uploaded app definition"),this.errorInfo=null,this.extensionManifestService.extractAppDefinition(e,!0).then(function(n){var a={appDefinitionSideloaded:{appDefinition:n},intent:t.intent,teamId:t.teamId,teamName:t.teamName,chatId:t.preselectChat,autoNavigationOnDone:t.autoNavigationOnDone,viewOnly:!1,skipInstalledSuccess:t.skipInstalledSuccess,preselectTeam:t.preselectTeam,preselectChannel:t.preselectChannel,preselectChat:t.preselectChat,category:t.galleryCategory,storeLaunchFromChat:t.storeLaunchFromChat,file:e,source:"td-apps-gallery-sideload"};return(t.settingsService.valueAsBoolean(t.constants.settings.names.enableHostedAppValidationDuringSideloading)?t.isValidContainerAndHostedApp(n):t.$q.resolve(!0)).then(function(n){if(!n)return t.$q.reject("Not a valid app definition for installation.");var i={entryPoint:teamspace.components.AddAppDialogEntryPoint.StoreSideload,manifestZipFile:e};return t.dialogService.openLazyDialog(t.constants.lazyDialogs.addAppNew,t.constants.lazyModules.extensibilityDialogs,Object.assign(a,i)),t.$q.resolve(null)})}).then(function(){n.stop()}).catch(function(e){n.fail({error:e,error1:e}),t.handleError(e,"Failed extract app definition")})}},e.prototype.uploadTenantApp=function(e){var t=this;if(e){this.errorInfo=null,this.isUploading=!0,this.updateManageAppMenuAndButton(),this.dismissUploadAppPopover();var n=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.gallery.uploadTenantApp);this.extensionManifestService.extractAppDefinition(e,!0).then(function(a){return n.mark(t.constants.scenarios.extensibility.apps.gallery.extractTenantAppDefinitionStep,{appId:a.id,externalId:a.externalId,tenantId:t.currentTenant&&t.currentTenant.tenantId}),t.appDefinitions.some(function(e){return e.externalId===a.externalId&&e.isTenantApp})?(t.handleError(t.$translate.instant(t.resources.strings.apps_gallery_errorDialog_reupload_error),"Tenant app definition already exists"),n.stop({appId:a.id,externalId:a.externalId,tenantId:t.currentTenant&&t.currentTenant.tenantId}),t.$q.reject({type:t.constants.extensibility.apps.errorCodes.handledError})):(a.id=a.externalId,(t.settingsService.valueAsBoolean(t.constants.settings.names.enableHostedAppValidationDuringSideloading)?t.isValidContainerAndHostedApp(a):t.$q.resolve(!0)).then(function(n){return n?t.enableSideloadAppByZip?t.extensionManifestService.getZipStreamPromise(e).then(function(e){return t.appsService.createTenantAppDefinitionFromZip(e,t.teamId)}):t.uploadTenantAppIcon(a).then(function(e){return e&&e.smallImageUrl&&e.largeImageUrl?(a.smallImageUrl=e.smallImageUrl,a.largeImageUrl=e.largeImageUrl,t.appsService.createTenantAppDefinition(a,t.teamId)):t.$q.reject("uploadTenantApp: Invalid image urls")}):t.$q.reject("Not a valid app definition for installation.")}))}).then(function(e){return n.mark(t.constants.scenarios.extensibility.apps.gallery.createTenantAppDefinitionStep,{appId:e.id,externalId:e.externalId,tenantId:t.currentTenant&&t.currentTenant.tenantId}),t.invalidateAppsCache(),t.categories.every(function(e){return e.value!==A})&&(t.categories=t.categories.slice(0,t.categoryIndexToAddSpace).concat([{value:A,text:t.currentTenant?t.currentTenant.tenantName:t.$translate.instant(t.resources.strings.extensibility_apps_gallery_tenantapps_option),title:t.currentTenant?t.currentTenant.tenantName:t.$translate.instant(t.resources.strings.extensibility_apps_gallery_tenantapps_option),hasTopPadding:!0}],t.categories.slice(t.categoryIndexToAddSpace))),t.galleryCategory===A?(t.appDefinitions.push(t.convertToGalleryViewAppViewModel(e,!1)),t.appDefinitions.sort(t.compare.bind(t)),t.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.LOB]=t.appDefinitions,t.$timeout(function(){t.setFocus(e.id)}),t.$q.resolve()):(t.appDefinitions=[],t.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.LOB].push(e),t.changeCategory(t.categories.find(function(e){return e.value===A})))}).catch(function(e){if(e.type)switch(e.type){case t.constants.extensibility.apps.errorCodes.handledError:return;case t.constants.extensibility.apps.errorCodes.manifestError:n.cancel({error:e,error1:e}),t.handleError(e,"Failed to validate tenant app manifest");break;case t.constants.extensibility.apps.errorCodes.iconError:n.fail({error:e,error1:e}),t.handleError(t.$translate.instant(t.resources.strings.apps_gallery_errorDialog_icon_error),"Failed to upload tenant app icons");break;default:n.fail({error:e,error1:e}),t.handleError(e,"Failed to upload tenant app package")}else e.data&&e.data.errorCode&&e.data.errorCode===t.constants.extensibility.apps.errorCodes.appDefinitionAlreadyExists?(n.cancel({error:e,error1:e}),t.handleError(t.$translate.instant(t.resources.strings.apps_gallery_errorDialog_reupload_error),"Tenant app definition already exists")):e.data&&e.data.errorCode===t.constants.extensibility.apps.errorCodes.unableToParseTeamsAppManifest?(n.cancel({error:e,error1:e}),t.handleManifestParseError(e.data.message)):(n.fail({error:e,error1:e}),t.handleError(e,"Failed to upload tenant app package"))}).finally(function(){t.isUploading=!1,t.updateManageAppMenuAndButton(),t.updateGrid(!0),n.stop(),t.logUploadTenantAppAction()})}},e.prototype.updateTenantApp=function(e){var t=this;if(e){this.errorInfo=null,this.isUpdating=!0,this.updateGrid(!1),this.dismissManageAppPopover();var n=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.gallery.updateTenantApp);this.extensionManifestService.extractAppDefinition(e,!0).then(function(a){n.mark(t.constants.scenarios.extensibility.apps.gallery.extractTenantAppDefinitionStep,{appId:a.id,externalId:a.externalId,tenantId:t.currentTenant&&t.currentTenant.tenantId});var i=t.appDefinitions.find(function(e){return e.id===t.selectedAppId});return angular.isUndefined(i)||i.externalId!==a.externalId?(t.handleError(t.$translate.instant(t.resources.strings.apps_gallery_errorDialog_manifest_id_mismatch),"App Id didn't match for tenant app update"),n.stop({appId:a.id,externalId:a.externalId,tenantId:t.currentTenant&&t.currentTenant.tenantId}),t.$q.reject({type:t.constants.extensibility.apps.errorCodes.handledError})):i.version===a.version?(t.handleError(t.$translate.instant(t.resources.strings.apps_gallery_errorDialog_manifest_version_error),"Same app version for tenant app update"),n.stop({appId:a.id,externalId:a.externalId,tenantId:t.currentTenant&&t.currentTenant.tenantId}),t.$q.reject({type:t.constants.extensibility.apps.errorCodes.handledError})):t.currentTenant?(a.id=t.selectedAppId,(t.settingsService.valueAsBoolean(t.constants.settings.names.enableHostedAppValidationDuringSideloading)?t.isValidContainerAndHostedApp(a):t.$q.resolve(!0)).then(function(n){return n?t.enableSideloadAppByZip?t.extensionManifestService.getZipStreamPromise(e).then(function(e){return t.appsService.updateTenantAppDefinitionFromZip(e,a,t.teamId)}):t.uploadTenantAppIcon(a).then(function(e){return a.smallImageUrl=e&&e.smallImageUrl?e.smallImageUrl:k,a.largeImageUrl=e&&e.largeImageUrl?e.largeImageUrl:k,t.appsService.updateTenantAppDefinition(a,t.teamId)}):t.$q.reject("Not a valid app definition for installation.")})):t.$q.reject("Tenant information is not present")}).then(function(e){n.mark(t.constants.scenarios.extensibility.apps.gallery.updateTenantAppDefinitionStep,{appId:e.id,externalId:e.externalId,tenantId:t.currentTenant&&t.currentTenant.tenantId}),t.allApps=t.appDefinitions;var a=_.findIndex(t.allApps,function(t){return t.id===e.id});t.allApps.splice(a,1,t.convertToGalleryViewAppViewModel(e,!1)),t.appDefinitions=[],t.appDefinitions=t.allApps,t.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.LOB]=t.appDefinitions,t.$timeout(function(){t.setFocus(e.id)})}).catch(function(e){if(e.type)switch(e.type){case t.constants.extensibility.apps.errorCodes.handledError:return;case t.constants.extensibility.apps.errorCodes.manifestError:n.cancel({error:e,error1:e}),t.handleError(e,"Failed to validate tenant app manifest");break;case t.constants.extensibility.apps.errorCodes.iconError:n.fail({error:e,error1:e}),t.handleError(t.$translate.instant(t.resources.strings.apps_gallery_errorDialog_icon_error),"Failed to update tenant app icons");break;default:n.fail({error:e,error1:e}),t.handleError(e,"Failed to update tenant app package")}else e.data&&e.data.errorCode===t.constants.extensibility.apps.errorCodes.unableToParseTeamsAppManifest?(n.fail({error:e,error1:e}),t.handleManifestParseError(e.data.message)):(n.fail({error:e,error1:e}),t.handleError(e,"Failed to update tenant app package"))}).finally(function(){t.isUpdating=!1,n.stop(),t.logUpdateTenantAppAction(),t.updateGrid(!0)})}},e.prototype.deleteTenantApp=function(){var e=this,t=this.appDefinitions.find(function(t){return t.id===e.selectedAppId});this.errorInfo=null,this.currentTenant||this.handleError(this.$translate.instant(this.resources.strings.td_apps_tab_error),"Tenant information is not present. AppId:"+this.selectedAppId),this.dismissManageAppPopover();var n=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.gallery.deleteTenantApp),a={closeButtonText:this.$translate.instant(this.resources.strings.cancel),okButtonText:this.$translate.instant(this.resources.strings.app_deleteTeamButtonText),confirmMessageTitle:this.$translate.instant(this.resources.strings.app_delete_dialog_confirmation_text,{appName:t.name}),confirmMessageHtmlBody:this.$translate.instant(this.resources.strings.app_delete_dialog_confirmation_details,{appName:t.name,tenantName:this.currentTenant.tenantName}),showAffirmationAfterAction:!1,reconfirmMessage:this.$translate.instant(this.resources.strings.app_delete_dialog_reconfirmation_text),clickSilent:!0,callback:function(){e.isInlineDeleting=!0,e.updateGrid(!1),e.appsService.deleteTenantAppDefinition(e.selectedAppId,e.teamId).then(function(){return _.remove(e.appDefinitions,function(t){return t.id===e.selectedAppId}),e.enableUseStoreApi&&e.removeAppFromStoreMap(e.selectedAppId),e.isInlineDeleting=!1,e.invalidateAppsCache(),e.appDefinitions.every(function(e){return!e.isTenantApp})?(_.remove(e.categories,function(e){return e.value===A}),e.isDeleting=!0,e.changeCategory(e.categories.find(function(e){return e.value===g}))):(e.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.LOB]=e.appDefinitions,e.$q.resolve())}).catch(function(a){a&&a.type===e.constants.extensibility.apps.errorCodes.amsError?(n.fail({appId:t.id,externalId:t.externalId,tenantId:e.currentTenant&&e.currentTenant.tenantId,error:a,error1:a}),e.handleError(a,"Failed to remove image from ams, appId: "+e.selectedAppId)):(n.fail({appId:t.id,externalId:t.externalId,tenantId:e.currentTenant&&e.currentTenant.tenantId,error:a,error1:a}),e.handleError(a,"Failed to delete app, appId: "+e.selectedAppId))}).finally(function(){e.isInlineDeleting=!1,e.isDeleting=!1,n.stop({appId:t.id,externalId:t.externalId,tenantId:e.currentTenant&&e.currentTenant.tenantId}),e.logDeleteTenantAppAction(),e.updateGrid(!0),e.$timeout(function(){e.setFocus()})})}};this.dialogService.open(this.constants.dialogs.confirmDialog,a)},e.prototype.isValidContainerAndHostedApp=function(e){var t=this;return this.getInstalledAppsPromise.then(function(n){return!t.settingsService.valueAsBoolean(t.constants.settings.names.enableContainerApps)||teamspace.services.AppsServiceUtils.isValidUserAppDefinition(e,n)})},e.prototype.uploadTenantAppIcon=function(e){var t=[];return this.isBase64(e.smallImageUrl)&&this.isBase64(e.largeImageUrl)?(t.push(this.uploadbase64Icon(e.smallImageUrl)),t.push(this.uploadbase64Icon(e.largeImageUrl)),this.$q.all(t).then(function(e){return{smallImageUrl:e[0],largeImageUrl:e[1]}})):this.$q.reject("uploadTenantAppIcon: Image urls are not base64")},e.prototype.isBase64=function(e){return e&&0===e.indexOf("data:")},e.prototype.getTenantAppsSectionNameLabel=function(e,t){if(!t)return this.$translate.instant(this.resources.strings.extensibility_apps_gallery_tenantapps_option);if(!e)return this.$translate.instant(this.resources.strings.extensibility_apps_gallery_lob_apps_option,{tenantName:t});switch(e.toLowerCase()){case"companyapps":return this.$translate.instant(this.resources.strings.extensibility_apps_gallery_tenantapps_option);case"builtfororg":default:return this.$translate.instant(this.resources.strings.extensibility_apps_gallery_lob_apps_option,{tenantName:t})}},e.prototype.uploadbase64Icon=function(e){var t=this;if(!this.currentTenant||!this.currentTenant.tenantId)return this.$q.reject("Tenant information is not present");var n=e.indexOf(",");if(n<0)return this.$q.reject({type:this.constants.extensibility.apps.errorCodes.iconError,error:"Icon format error"});for(var a=atob(e.substring(n+1)),i=a.length,s=new Uint8Array(new ArrayBuffer(i)),r=0;r<i;r++)s[r]=a.charCodeAt(r);if(a){var o={containerId:"*:tid:"+this.currentTenant.tenantId};return this.filesAsyncMediaService.uploadItem(o,s).then(function(e){return t.$q.resolve(e.fullsizeUrl)}).catch(function(e){return t.$q.reject({type:t.constants.extensibility.apps.errorCodes.amsError,error:"Icon upload error:"+JSON.stringify(e)})})}return this.$q.reject({type:this.constants.extensibility.apps.errorCodes.iconError,error:"Icon format error"})},e.prototype.invalidateAppsCache=function(){delete this.getAppsPromise,this.getAppsPromise=this.teamId?this.appsService.getTeamAppDefinitions(this.teamId,"td-apps-gallery",this.getAppsPromiseOptions):this.appsService.getUserAppDefinitions("td-apps-gallery",this.getAppsPromiseOptions)},e.prototype.handleError=function(e,t){var n=t+". Error: ";e.type===this.constants.extensibility.apps.errorCodes.manifestError?this.dialogService.openLazyDialog(this.constants.lazyDialogs.manifestError,this.constants.lazyModules.extensibilityDialogs,{errorMessage:this.$translate.instant(this.resources.strings.extension_addAppDialogManifestParsingErrorMessage),errorDetails:e.errors}):"string"==typeof e?(n+=e,this.showErrorDialog(e)):(n+=JSON.stringify(e),this.errorInfo=this.$translate.instant(this.resources.strings.td_apps_tab_error),this.showErrorInfoBanner(this.errorInfo)),this.loggingService.error(n)},e.prototype.handleManifestParseError=function(e){this.dialogService.openLazyDialog(this.constants.lazyDialogs.manifestError,this.constants.lazyModules.extensibilityDialogs,{errorMessage:this.$translate.instant(this.resources.strings.extension_addAppDialogManifestParsingErrorMessage),errorDetails:e})},e.prototype.showErrorInfoBanner=function(e){null!=this.errorInfoBanner&&this.errorInfoBanner.hide(),this.errorInfoBanner=this.appStateAdapter.mainNotificationBannerStore.showBanner(teamspace.services.Severity.Warning,e,"banner_error_info",{autoHideTimer:10})},e.prototype.changeCategory=function(e,t){var n=this;if(!t||t.which===this.constants.keyCodes.enter){e&&(this.galleryCategory=e.value,this.rightRailRegionLabel=e.text,this.searchString="",this.updateManageAppMenuAndButton(),teamspace.services.AppsServiceCategoryFilter[this.galleryCategory]?this.category=teamspace.services.AppsServiceCategoryFilter[this.galleryCategory]:this.category=teamspace.services.AppsServiceCategoryFilter.All,this.updateBanner());var a=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.gallery.changeCategory);return this.allApps=[],this.getExtensionGalleryItems(this.category,this.galleryCategory).catch(function(e){a.fail({error:e,error1:e}),n.errorInfo="string"==typeof e?e:n.$translate.instant(n.resources.strings.td_apps_gallery_error),n.showErrorInfoBanner(n.errorInfo)}).finally(function(){n.isLoading=!1,a.stop(),n.logCategoryChangeAction(e),t&&t.which===n.constants.keyCodes.enter&&n.$timeout(function(){n.setFocus()}),n.updateGrid(!0)})}},e.prototype.imageLoadCheck=function(){var e=this;if(this.isUrl){var t=new Image;t.src=this.lobBackground,t.onerror=function(){e.isBackgroundLoaded=!1}}var n=new Image;n.src=this.lobLogo,n.onerror=function(){e.isLogoLoaded=!1}},e.prototype.filterBySearch=function(){this.filterBySearchDebounce()},e.prototype.goToLearnMore=function(){this.helpService.gotoHelp("Articles-AppsAndServices/6c25661b-90f8-4b52-92b2-1fcd3e5d946c")},e.prototype.onFeaturedAppClicked=function(e){var t=_.find(this.featuredAppDefinitions,function(t){return t.id.toLowerCase()===e.toLowerCase()});t&&this.onAppClicked(t,!0)},e.prototype.onAppClicked=function(e,t,n){var a=this;this.eventingService.$once(this.$scope,this.constants.events.app.installed,function(t,n){var i=n.result;i&&i.installSucceeded&&(a.teamId?a.appsService.getInstalledAppForTeam(a.teamId,e.id):a.appsService.getInstalledAppForUser(e.id)).then(function(t){t.appDefinition.id===e.id&&(e.isInstalled=teamspace.services.AppsServiceUtils.isAppInstalled(t))})});var i,s={appID:e.id,intent:this.intent,teamId:this.teamId,chatId:this.preselectChat,messageId:this.messageId,teamName:this.teamName,autoNavigationOnDone:this.autoNavigationOnDone,action:teamspace.components.AddAppDialogAction.Install,skipInstalledSuccess:this.skipInstalledSuccess,preselectTeam:this.preselectTeam,preselectChannel:this.preselectChannel,preselectChat:this.preselectChat,category:this.galleryCategory,storeLaunchFromChat:this.storeLaunchFromChat,source:"td-apps-gallery"},r=n?T[n]:void 0;switch(this.addAppDialogEntryPoint){case teamspace.components.AddAppDialogEntryPoint.InContextGalleryDialogMoreAppsFromChannel:i={entryPoint:this.addAppDialogEntryPoint,appId:e.id,teamId:this.teamId||this.preselectTeam,channelId:this.preselectChannel,fromSectionName:r};break;case teamspace.components.AddAppDialogEntryPoint.InContextGalleryDialogMoreAppsFromGroupChat:i={entryPoint:this.addAppDialogEntryPoint,appId:e.id,chatId:this.preselectChat,fromSectionName:r};break;case teamspace.components.AddAppDialogEntryPoint.Flyout:i={appId:e.id,entryPoint:this.addAppDialogEntryPoint,fromSectionName:r};break;case teamspace.components.AddAppDialogEntryPoint.MessagingExtensionFlyoutFromChannel:i={entryPoint:this.addAppDialogEntryPoint,appId:e.id,teamId:this.teamId||this.preselectTeam,channelId:this.preselectChannel,fromSectionName:r};break;case teamspace.components.AddAppDialogEntryPoint.MessagingExtensionFlyoutFromChat:i={entryPoint:this.addAppDialogEntryPoint,appId:e.id,fromSectionName:r};break;case teamspace.components.AddAppDialogEntryPoint.AppsManagementTabFromTeam:i={entryPoint:this.addAppDialogEntryPoint,appId:e.id,teamId:this.teamId||this.preselectTeam,fromSectionName:r};break;case teamspace.components.AddAppDialogEntryPoint.AppsManagementTabFromGroupChat:i={entryPoint:this.addAppDialogEntryPoint,appId:e.id,chatId:this.preselectChat,fromSectionName:r};break;default:i={entryPoint:teamspace.components.AddAppDialogEntryPoint.Store,appId:e.id,fromSectionName:r}}this.dialogService.openLazyDialog(this.constants.lazyDialogs.addAppNew,this.constants.lazyModules.extensibilityDialogs,Object.assign(s,i)),this.logAppClickAction(e,t,r)},e.prototype.getTitleText=function(){var e=this,t=_.filter(this.categories,function(t){return t.value===e.galleryCategory});return t?t[0].title:""},e.prototype.getTypeDescription=function(e){switch(this.galleryCategory){case u:return"type"===e?this.$translate.instant(this.resources.strings.extensibility_apps_gallery_bots_option):this.$translate.instant(this.resources.strings.extensibility_apps_gallery_title_bots);case h:return"type"===e?this.$translate.instant(this.resources.strings.extensibility_apps_gallery_tabs_option):this.$translate.instant(this.resources.strings.extensibility_apps_gallery_title_tabs);case m:return"type"===e?this.$translate.instant(this.resources.strings.extensibility_apps_gallery_connectors_option):this.$translate.instant(this.resources.strings.extensibility_apps_gallery_title_connectors);case v:return"type"===e?this.$translate.instant(this.resources.strings.extensibility_apps_messaging_option):this.$translate.instant(this.resources.strings.extensibility_apps_gallery_title_messaging);case d:return"type"===e?this.$translate.instant(this.resources.strings.extensibility_consent_badge_personal_app):this.$translate.instant(this.resources.strings.extensibility_apps_gallery_title_personal);default:return""}},e.prototype.showUploadOptions=function(e){var t=this,n={templateUrl:"components/extensibility/td-apps-gallery/td-apps-gallery-upload-options.html",trigger:"manual",container:"td-apps-gallery",scope:this.$scope,autoClose:!1,placement:"auto bottom-right"},a={sourceElement:angular.element(e.currentTarget),tooltipType:teamspace.services.TooltipType.Popover,options:n,tooltipId:"upload-app-options",cssApplicator:function(){t.tooltipCssApplicators.contextMenu(e,"app-upload-menu",null,angular.element(e.currentTarget))}};e.stopPropagation(),this.tooltipService.toggleTooltip(a)},e.prototype.showManageAppOptions=function(e,t){var n=this;this.dismissManageAppPopover(e),this.selectedAppId=e,this.updateGrid(!1);var a={templateUrl:"components/extensibility/td-apps-gallery/td-apps-gallery-manage-app-options.html",trigger:"manual",container:"td-apps-gallery",scope:this.$scope,autoClose:!1,placement:"auto bottom-right"},i="div[id='app-"+e+"-manageAppMenu']",s={sourceElement:angular.element(t.currentTarget),tooltipType:teamspace.services.TooltipType.Popover,options:a,tooltipId:"manage-app-options-"+e,cssApplicator:function(){n.tooltipCssApplicators.contextMenu(t,i,null,angular.element(t.currentTarget),-5,54)}};t.stopPropagation(),t.preventDefault(),this.tooltipService.toggleTooltip(s)},e.prototype.copyLinkToApp=function(e){var t,n=this,a="apps-gallery-"+this.selectedAppId,i=this.deepLinkProvider.getAppDeepLinkUrl(this.selectedAppId,teamspace.services.AppDeeplinkSource.StoreCopyLink);if(this.enableUseStoreApi&&this.galleryCategory==g){var s=[];s.push.apply(s,this.appDefinitions),s.push.apply(s,this.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.NEW]),s.push.apply(s,this.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.LOB]),s.push.apply(s,this.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.POPULAR]),t=s.find(function(e){return e.id===n.selectedAppId})}else t=this.appDefinitions.find(function(e){return e.id===n.selectedAppId});var r=this.utilityService.escapeHtml(t.name||i),o=teamspace.services.MessagingUtilities.getPrettyLink(r,i,"",!1),p={};p[teamspace.services.UtilityServiceStatics.ClipboardFormats.Text]=i,p[teamspace.services.UtilityServiceStatics.ClipboardFormats.Html]=o.innerHTML,this.utilityService.copyMultipleFormatsToClipboard(p);var l=angular.element(document.getElementById(a));if(l){var c=l.find(".icons-more");c&&this.tooltipService.showLinkCopiedTooltip(e,this.$scope,c,c,12)}},e.prototype.dismissUploadAppPopover=function(){this.tooltipService.clearTooltip(teamspace.services.TooltipType.Popover,"upload-app-options")},e.prototype.dismissManageAppPopover=function(e){e&&this.selectedAppId===e||this.tooltipService.clearTooltip(teamspace.services.TooltipType.Popover,"manage-app-options-"+this.selectedAppId)},e.prototype.goToSection=function(e){0!==e&&T[e]&&(this.galleryCategory=T[e],this.filterBySection(),this.updateGrid(!0),this.updateBanner(),this.logGoToSectionAction(T[e]))},e.prototype.filterBySearchFunction=function(){var e=this;if(this.updateManageAppMenuAndButton(),this.showNoResult=!1,""==this.searchString){this.searchInstance=void 0;this.allApps=[],this.getExtensionGalleryItems(this.category,this.galleryCategory).catch(function(t){e.errorInfo="string"==typeof t?t:e.$translate.instant(e.resources.strings.td_apps_gallery_error),e.showErrorInfoBanner(e.errorInfo)}).finally(function(){0==e.appDefinitions.length&&(e.showNoResult=!0),e.isLoading=!1,e.updateGrid(!0)})}else{this.allApps=[],this.initializeSearchInstance().catch(function(t){e.errorInfo="string"==typeof t?t:e.$translate.instant(e.resources.strings.td_apps_gallery_error),e.showErrorInfoBanner(e.errorInfo)}).finally(function(){e.appDefinitions=e.searchInstance.search(e.searchString.split(" ")).getResults(),0==e.appDefinitions.length&&(e.showNoResult=!0),e.announceSearchResultsChanged(e.appDefinitions.length),e.isLoading=!1,e.updateGrid(!0)})}this.logSearchAction(this.searchString)},e.prototype.initializeSearchInstance=function(){var e=this;if(this.searchInstance)return this.$q.resolve();if(this.enableUseStoreApi){var t=this.getCompleteAppListForCategory(g,!1);return t.then(function(t){return e.setSearchInstance(t),e.$q.resolve()})}return(t=this.getExtensionGalleryItems(teamspace.services.AppsServiceCategoryFilter.All,g,!0)).then(function(){return e.setSearchInstance(e.appDefinitions),e.$q.resolve()})},e.prototype.setSearchInstance=function(e){this.searchInstance=new c.Search(e,[new c.LevenshteinDistanceStrategy("appname",{tokenizer:new c.SplitAndLeadingSubStrsTokenizer,getTargetText:function(e){return e.name.toLocaleLowerCase()},getThreshold:function(e){return e/2}}),new c.ContainsStrategy("description",{getTargetText:function(e){return e.description.toLocaleLowerCase()},rankModifier:.3}),new c.LevenshteinDistanceStrategy("category",{tokenizer:new c.SplitAndLeadingSubStrsTokenizer,getTargetText:function(e){return e.category},getThreshold:function(){return 1},rankModifier:.2})])},e.prototype.appActionDisabled=function(){return this.isUploading||this.isUpdating||this.isDeleting||this.isInlineDeleting},e.prototype.updateManageAppMenuAndButton=function(){this.showManageAppButton=this.enableTenantOwnedApps&&!this.isUploading&&!this.searchString&&this.userCanManageTenantApps&&this.galleryCategory==A,this.updateGrid(!1)},e.prototype.filterBySection=function(){switch(this.galleryCategory){case d:this.appDefinitions=this.appGalleryLeftRailPersonalAppDefinitions;break;case f:this.appDefinitions=this.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.NEW];break;case A:this.appDefinitions=this.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.LOB],this.updateManageAppMenuAndButton();break;case b:this.appDefinitions=this.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.POPULAR];break;case y:this.appDefinitions=this.enableUseStoreApi?this.featuredAppDefinitions:this.allApps;break;default:this.appDefinitions=this.allApps}},e.prototype.getExtensionGalleryItems=function(e,t,n){var a=this;return this.isLoading=!this.isUploading&&!this.isDeleting,this.enableUseStoreApi?this.getInstalledAppsPromise.then(function(e){var i=[];_.some(a.preLoadedCategories,function(e){return t==e})||(i=a.getStoreMapCategories(t)),_.isEmpty(i)||(_.forEach(i,function(t){_.forEach(a.storeCategoryMap[t.toLowerCase()],function(t){if(t&&t.appDefinition&&teamspace.services.AppsServiceUtils.isStoreFrontApp(e,t.appDefinition)){var n=a.isInstalledApp(e,t.appDefinition.id);a.allApps.push(a.convertToGalleryViewAppViewModel(t.appDefinition,n,t.ranking))}})}),a.allApps=_.uniqBy(a.allApps,"id")),a.sortAndFilterExtensionGalleryItems(t,n)}):this.teamAndChannelPromise.then(function(){return a.$q.all([a.getInstalledAppsPromise,a.getAppsPromise,a.getAppRankMapPromise]).then(function(i){a.appSortingRule&&(a.appRankMap=i[2]);var s=i[0],r=i[1];(r=teamspace.services.AppsServiceUtils.filterToStoreFrontApps(s,r)).forEach(function(n){var i=s?s.find(function(e){return e.appDefinition.id.toLowerCase()===n.id}):void 0;(!a.categoryMapping[t]||!_.isEmpty(n.categories)&&a.isCategoryIncluded(n,t))&&(e===teamspace.services.AppsServiceCategoryFilter.All||a.passesCapabilityFilter(n,e))&&(t!==y||_.some(a.featuredAppDefinitions,function(e){return e.id===n.id}))&&("Other"!==t||_.isEmpty(n.categories)||n.categories.includes("Other")||a.appHasUnknownCategory(n))&&a.allApps.push(a.convertToGalleryViewAppViewModel(n,!!i&&teamspace.services.AppsServiceUtils.isAppInstalled(i)))}),a.sortAndFilterExtensionGalleryItems(t,n)})})},e.prototype.sortAndFilterExtensionGalleryItems=function(e,t){this.enableUseStoreApi?e===g?this.enableNewAppStorePopular?this.allApps.sort(this.compareByLocale.bind(this)):this.allApps.sort(this.compareByRanking.bind(this)):e!=d&&e!=f&&e!=y&&this.allApps.sort(this.compareByRanking.bind(this)):e===d||e===u||e===h||e===m||e===v?this.allApps.sort(this.compare.bind(this)):this.enableNewAppStore&&this.enableNewAppStorePopular&&!this.categoryMapping[e]?this.allApps.sort(this.compareByLocale.bind(this)):this.allApps.sort(this.compare.bind(this)),t?this.appDefinitions=this.allApps:this.filterBySection()},e.prototype.getStoreMapCategories=function(e){var t=[];return L[e]?t.push.apply(t,L[e]):_.some(this.storeMapQueryableCategories,function(t){return t.toLowerCase()===e.toLowerCase()})&&t.push(e),t},e.prototype.getGalleryKeywordFromStoreMapCategory=function(e){return _.find(this.storeMapQueryableCategories,function(t){return e.toLowerCase()==t.toLowerCase()})},e.prototype.convertToGalleryViewAppViewModel=function(e,t,n){return{officeAssetId:e.officeAssetId,id:e.id,name:e.name,developerName:e.developerName,description:e.longDescription,icon:e.largeImageUrl,accentColor:e.accentColor,isInstalled:t,version:e.version,bots:e.bots,galleryTabs:e.galleryTabs,inputExtensions:e.inputExtensions,connectors:e.connectors,category:e.categories&&e.categories[0]?this.$translate.instant(this.resources.strings[this.constants.extensibility.store.AppStoreCategoryStringMapping[e.categories[0]]]):"",isTenantApp:!!e.tenantId,externalId:e.externalId,smallIcon:e.smallImageUrl,mpnId:e.mpnId,supportedLanguages:e.supportedLanguages,ranking:n,isHostedApp:teamspace.services.AppsServiceUtils.isHostedAppDefinition(e)}},e.prototype.isCategoryIncluded=function(e,t){return!_.isEmpty(_.intersection(e.categories,L[t]))},e.prototype.passesCapabilityFilter=function(e,t){return!!e&&((t&teamspace.services.AppsServiceCategoryFilter.Bots)==teamspace.services.AppsServiceCategoryFilter.Bots&&e.bots&&e.bots.length>0||(t&teamspace.services.AppsServiceCategoryFilter.Tabs)==teamspace.services.AppsServiceCategoryFilter.Tabs&&e.galleryTabs&&e.galleryTabs.length>0||(t&teamspace.services.AppsServiceCategoryFilter.InputExtensions)==teamspace.services.AppsServiceCategoryFilter.InputExtensions&&e.inputExtensions&&e.inputExtensions.length>0||(t&teamspace.services.AppsServiceCategoryFilter.Connectors)==teamspace.services.AppsServiceCategoryFilter.Connectors&&e.connectors&&e.connectors.length>0)},e.prototype.appHasUnknownCategory=function(e){var t=this;return _.some(e.categories,function(e){return t.constants.extensibility.store.AppStoreCategoryStringMapping[e]})},e.prototype.getCategorySetFromAppDefinitions=function(e){var t=this,n=[];return e.forEach(function(e){!!e&&n.push.apply(n,t.getMergedCategories(e.categories))}),(n=_.uniq(n)).sort()},e.prototype.getCategorySetFromStoreCategoryMap=function(e){var t=this,n=[];if(e&&!_.isEmpty(Object.keys(e))){var a=Object.keys(e).map(function(e){return t.getGalleryKeywordFromStoreMapCategory(e)});n.push.apply(n,this.getMergedCategories(a))}return(n=_.uniq(n)).sort()},e.prototype.getMergedCategories=function(e){var t=this,n=[];return!_.isEmpty(e)&&e.forEach(function(e){if(t.constants.extensibility.store.AppStoreCategoryStringMapping[e]){var a=_.findKey(L,function(t){return t.includes(e)});_.isUndefined(a)||n.push(a)}}),n},e.prototype.removeAppFromStoreMap=function(e){for(var t in this.storeCategoryMap)_.remove(this.storeCategoryMap[t],function(t){return!!t.appDefinition&&t.appDefinition.id==e})},e.prototype.insertTenantAppCategory=function(){this.categories=this.categories.slice(0,this.categoryIndexToAddSpace).concat([{value:A,text:this.storeTenantAppsSectionLabel,title:this.storeTenantAppsSectionLabel,hasTopPadding:!0}],this.categories.slice(this.categoryIndexToAddSpace))},e.prototype.compare=function(e,t){if(this.appRankMap&&this.appSortingRule===this.constants.extensibility.apps.appRanking.appSortingRuleInstall){var n=(this.appRankMap[t.id]?this.appRankMap[t.id].installRank:0)-(this.appRankMap[e.id]?this.appRankMap[e.id].installRank:0);return 0===n?e.name.toLocaleLowerCase()<t.name.toLocaleLowerCase()?-1:1:n}return e.name.toLocaleLowerCase()<t.name.toLocaleLowerCase()?-1:1},e.prototype.compareByRanking=function(e,t){var n=(t.ranking||0)-(e.ranking||0);return 0===n?e.name.toLocaleLowerCase()<t.name.toLocaleLowerCase()?-1:1:n},e.prototype.compareByLocale=function(e,t){var n=this;if(!this.userLanguage)return this.compare(e,t);var a,i,s;return"en-us"===this.userLanguage?(a=function(e){return"en"===(e=(e||"").toLowerCase())||"en-us"===e},i=!0,s=!0):(a=function(e){return(e=(e||"").toLowerCase())===n.userLanguage},i=!1,s=!1),i=e.supportedLanguages&&e.supportedLanguages.length>0?_.findIndex(e.supportedLanguages,a)>=0:i,s=t.supportedLanguages&&t.supportedLanguages.length>0?_.findIndex(t.supportedLanguages,a)>=0:s,i&&s?e.name.toLocaleLowerCase()<t.name.toLocaleLowerCase()?-1:1:i?-1:s?1:e.name.toLocaleLowerCase()<t.name.toLocaleLowerCase()?-1:1},e.prototype.logAppClickAction=function(e,t,n){var a=this;_.defer(function(){var i={action:{gesture:teamspace.components.PanelActionGesture.click,outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.select.toString(),teamspace.components.PanelActionOutcome,a.loggingService),scenario:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenario.openAddAppDialog.toString(),teamspace.components.PanelActionScenario,a.loggingService),scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.appMgmt.toString(),teamspace.components.PanelActionScenarioType,a.loggingService)},module:{name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.appsGalleryItem.toString(),teamspace.components.PanelModuleName,a.loggingService),type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.openDialog.toString(),teamspace.components.PanelModuleType,a.loggingService),summary:"Open app installation dialog for "+e.name,state:"Clicked"},dataBag:{isFeatured:!!t,fromSectionName:n},app:{id:e.id,name:e.name,version:e.version,isTenantApp:e.isTenantApp,externalId:e.externalId,mpnId:e.mpnId,isHostedApp:e.isHostedApp}};e.bots&&e.bots.length>0&&(i.bot={id:e.bots[0].id,name:e.name}),a.sendPanelAction(i)})},e.prototype.logCategoryChangeAction=function(e){var t=this;_.defer(function(){var n={action:{gesture:teamspace.components.PanelActionGesture.click,outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.nav.toString(),teamspace.components.PanelActionOutcome,t.loggingService),scenario:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenario.changeAppGalleryCategory.toString(),teamspace.components.PanelActionScenario,t.loggingService),scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.appMgmt.toString(),teamspace.components.PanelActionScenarioType,t.loggingService)},module:{name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.appsGalleryItem.toString(),teamspace.components.PanelModuleName,t.loggingService),type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.nav.toString(),teamspace.components.PanelModuleType,t.loggingService),summary:"Change category to "+(e?e.value:t.category.toString()),state:"Clicked"},dataBag:{category:e?e.value:t.category.toString()}};t.sendPanelAction(n)})},e.prototype.logUploadTenantAppAction=function(){var e=this;_.defer(function(){var t={action:{gesture:teamspace.components.PanelActionGesture.click,outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.upload.toString(),teamspace.components.PanelActionOutcome,e.loggingService),scenario:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenario.uploadTenantApp.toString(),teamspace.components.PanelActionScenario,e.loggingService),scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.appMgmt.toString(),teamspace.components.PanelActionScenarioType,e.loggingService)},module:{name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.appsGalleryItem.toString(),teamspace.components.PanelModuleName,e.loggingService),type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.menuItem.toString(),teamspace.components.PanelModuleType,e.loggingService),summary:"Upload tenant app from app store"}};e.sendPanelAction(t)})},e.prototype.logUpdateTenantAppAction=function(){var e=this;_.defer(function(){var t={action:{gesture:teamspace.components.PanelActionGesture.click,outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.upload.toString(),teamspace.components.PanelActionOutcome,e.loggingService),scenario:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenario.updateTenantApp.toString(),teamspace.components.PanelActionScenario,e.loggingService),scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.appMgmt.toString(),teamspace.components.PanelActionScenarioType,e.loggingService)},module:{name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.appsGalleryItem.toString(),teamspace.components.PanelModuleName,e.loggingService),type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.menuItem.toString(),teamspace.components.PanelModuleType,e.loggingService),summary:"Update tenant app from app store"}};e.sendPanelAction(t)})},e.prototype.logDeleteTenantAppAction=function(){var e=this;_.defer(function(){var t={action:{gesture:teamspace.components.PanelActionGesture.click,outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.submit.toString(),teamspace.components.PanelActionOutcome,e.loggingService),scenario:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenario.deleteTenantApp.toString(),teamspace.components.PanelActionScenario,e.loggingService),scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.appMgmt.toString(),teamspace.components.PanelActionScenarioType,e.loggingService)},module:{name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.appsGalleryItem.toString(),teamspace.components.PanelModuleName,e.loggingService),type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.menuItem.toString(),teamspace.components.PanelModuleType,e.loggingService),summary:"Delete tenant app from app store"}};e.sendPanelAction(t)})},e.prototype.logSearchAction=function(e){var t=this;_.defer(function(){var n={action:{gesture:teamspace.components.PanelActionGesture.submit,outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.search.toString(),teamspace.components.PanelActionOutcome,t.loggingService),scenario:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenario.storeSearchApp.toString(),teamspace.components.PanelActionScenario,t.loggingService),scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.appMgmt.toString(),teamspace.components.PanelActionScenarioType,t.loggingService)},module:{name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.appsGalleryItem.toString(),teamspace.components.PanelModuleName,t.loggingService),type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.search.toString(),teamspace.components.PanelModuleType,t.loggingService),state:e?"search":"clear search"}};t.sendPanelAction(n)})},e.prototype.logGoToSectionAction=function(e){var t=this;_.defer(function(){var n={action:{gesture:teamspace.components.PanelActionGesture.click,outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.submit.toString(),teamspace.components.PanelActionOutcome,t.loggingService),scenario:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenario.goToSection.toString(),teamspace.components.PanelActionScenario,t.loggingService),scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.appMgmt.toString(),teamspace.components.PanelActionScenarioType,t.loggingService)},module:{name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.appsGalleryItem.toString(),teamspace.components.PanelModuleName,t.loggingService),type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.nav.toString(),teamspace.components.PanelModuleType,t.loggingService),summary:"Go to section: "+e}};t.sendPanelAction(n)})},e.prototype.sendPanelAction=function(e){var t=this;this.analyticsService.getAnalyticsPanelActionEventData(e).then(function(e){t.analyticsService.sendPanelAction(e)})},e.prototype.updateGrid=function(e){if(e)if(this.enableIncrementalScrollForStore){var t=angular.element(".td-apps-gallery-container");t&&t.scrollTop(0),this.gridViewModel.increNum=0,this.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.FILTERED]=this.appDefinitions.slice(0,this.firstPageAppsCount),this.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.ALL]=this.allApps.slice(0,this.bottomAppsCount),this.gridViewModel.isLoadingMoreApps=this.shouldShowScrollLoading()}else this.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.FILTERED]=this.appDefinitions,this.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.ALL]=this.allApps;this.gridViewModel.isUpdating!==this.isUpdating&&(this.gridViewModel.isUpdating=this.isUpdating),this.gridViewModel.selectedAppId!==this.selectedAppId&&(this.gridViewModel.selectedAppId=this.selectedAppId),this.gridViewModel.isInlineDeleting!==this.isInlineDeleting&&(this.gridViewModel.isInlineDeleting=this.isInlineDeleting)},e.prototype.shouldShowScrollLoading=function(){return!!this.enableIncrementalScrollForStore&&(!(!this.enableUseStoreApi||this.isCategoryComplete(this.galleryCategory))||(this.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.FILTERED].length<this.appDefinitions.length||this.enableNewAppStore&&this.galleryCategory===g&&!this.searchString&&this.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.ALL].length<this.allApps.length))},e.prototype.isCategoryComplete=function(e){var t,n=this;return _.some(this.preLoadedCategories,function(t){return e==t})?t=!0:_.forEach(this.getStoreMapCategories(e),function(e){if((e=e.toLowerCase())in n.categoryCompletenessMap&&!n.categoryCompletenessMap[e])return t=!1,!1;t=!0}),t},e.prototype.calculateAppsDisplayed=function(){var e=angular.element(w),t=angular.element(x),n=t&&t[0]&&e&&e[0]?Math.floor(t[0].clientWidth/e[0].offsetWidth):C;this.firstPageAppsCount=e&&e[0]?Math.ceil($(window).height()/e[0].clientHeight)*n+n:this.defaultFirstPageAppCount;var a=this.firstPageAppsCount-(this.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.NEW].length>this.sectionAppNum?this.sectionAppNum:this.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.NEW].length)-(this.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.LOB].length>this.sectionAppNum?this.sectionAppNum:this.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.LOB].length)-(this.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.POPULAR].length>this.sectionAppNum?this.sectionAppNum:this.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.POPULAR].length);this.bottomAppsCount=a>n?a:n,(this.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.ALL].length<this.bottomAppsCount||this.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.FILTERED].length<this.firstPageAppsCount)&&(this.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.ALL]=this.allApps.slice(0,this.bottomAppsCount),this.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.FILTERED]=this.appDefinitions.slice(0,this.firstPageAppsCount)),this.gridViewModel.isLoadingMoreApps=this.shouldShowScrollLoading()},e.prototype.populateBannerProps=function(e){this.templateType=e.templateType==a.Generic?a.Generic:a.FourAppsBanner,this.bannerTitle=e.title?e.title:this.$translate.instant(this.resources.strings.extensibility_apps_gallery_banner_cat_all_apps_title),this.bannerSubtitle1=e.subtitle1?e.subtitle1:this.$translate.instant(this.resources.strings.extensibility_apps_gallery_banner_cat_all_apps_content),this.bannerSubtitle2=e.subtitle2,this.bannerBackground=e.backgroundImgSrc},e.prototype.updateBanner=function(){var e=this;this.showBannerTemplate=this.enableBannerAppsPoweredByCxcs&&this.galleryCategory==g&&this.templateType==a.FourAppsBanner;var t=function(t,n,a,i,s,r,o,p,l,c){e.bannerViewModel.hideBanner=!1,e.bannerViewModel.title=e.$translate.instant(t),e.bannerViewModel.content=e.$translate.instant(n),e.bannerViewModel.imageSrc=a,e.bannerViewModel.learnMoreButtonTitle=e.$translate.instant(i),e.bannerViewModel.learnMoreButtonIconSrc=p,e.bannerViewModel.showLearnMoreButton=l||!1,e.bannerViewModel.learnMoreButtonClick=c||function(){return e.goToLearnMore()},e.bannerViewModel.onBannerAppClicked=function(t){return e.onFeaturedAppClicked(t)},e.bannerViewModel.subtitle1=s,e.bannerViewModel.subtitle2=r,e.bannerViewModel.backgroundSrc=o};switch(_.isEmpty(this.bannerImages)&&(this.bannerImages=this.settingsService.valueFor(this.constants.settings.names.appsGalleryBannerImages)),this.showLobBanner=!1,this.galleryCategory){case g:if(this.enableAppsUserOnboarding)if(this.enableBannerAppsPoweredByCxcs&&this.templateType)switch(this.templateType){case a.FourAppsBanner:t(this.bannerTitle,null,null,this.resources.strings.extensibility_apps_gallery_banner_btn_learn_more,this.bannerSubtitle1,this.bannerSubtitle2,this.bannerBackground,"svg/icons-info.html",!0,function(){e.$window.open(M)});break;case a.Generic:default:t(this.resources.strings.extensibility_apps_gallery_banner_cat_all_apps_title,this.resources.strings.extensibility_apps_gallery_banner_cat_all_apps_content,this.bannerImages[g]||"",this.resources.strings.extensibility_apps_gallery_banner_btn_learn_more,null,null,null,"svg/icons-info.html",!0,function(){e.$window.open(M)})}else t(this.resources.strings.extensibility_apps_gallery_banner_cat_all_apps_title,this.resources.strings.extensibility_apps_gallery_banner_cat_all_apps_content,this.bannerImages[g]||"",this.resources.strings.extensibility_apps_gallery_banner_btn_learn_more,null,null,null,"svg/icons-info.html",!0,function(){e.$window.open(M)});else t(this.resources.strings.extensibility_apps_gallery_banner_cat_all_apps_title,this.resources.strings.extensibility_apps_gallery_banner_cat_all_apps_content,this.bannerImages[g]||"",this.resources.strings.extensibility_apps_gallery_banner_btn_top_picks,null,null,null,null,!_.isEmpty(this.featuredAppDefinitions),function(){var t=_.find(e.categories,{value:y});t?e.changeCategory(t):e.goToLearnMore()});break;case d:t(this.resources.strings.extensibility_apps_gallery_banner_cat_personal_apps_title,this.resources.strings.extensibility_apps_gallery_banner_cat_personal_apps_content,this.bannerImages[d]||"",this.resources.strings.extensibility_apps_gallery_banner_btn_top_picks);break;case u:t(this.resources.strings.extensibility_apps_gallery_banner_cat_bots_title,this.resources.strings.extensibility_apps_gallery_banner_cat_bots_content,this.bannerImages[u]||"",this.resources.strings.extensibility_apps_gallery_banner_btn_top_picks);break;case h:t(this.resources.strings.extensibility_apps_gallery_banner_cat_tabs_title,this.resources.strings.extensibility_apps_gallery_banner_cat_tabs_content,this.bannerImages[h]||"",this.resources.strings.extensibility_apps_gallery_banner_btn_top_picks);break;case m:t(this.resources.strings.extensibility_apps_gallery_banner_cat_connectors_title,this.resources.strings.extensibility_apps_gallery_banner_cat_connectors_content,this.bannerImages[m]||"",this.resources.strings.extensibility_apps_gallery_banner_btn_top_picks);break;case v:t(this.resources.strings.extensibility_apps_gallery_banner_cat_messaging_title,this.resources.strings.extensibility_apps_gallery_banner_cat_messaging_content,this.bannerImages[v]||"",this.resources.strings.extensibility_apps_gallery_banner_btn_top_picks);break;case A:this.enableLobBanner?(this.imageLoadCheck(),this.showLobBanner=!0,this.lobBannerViewModel.lobTitle=this.$translate.instant(this.resources.strings.extensibility_apps_gallery_banner_cat_lob_apps_title,{tenantName:this.currentTenant.tenantName}),this.lobBannerViewModel.lobTextColor=this.lobTextColor,this.lobBannerViewModel.lobBackground=this.lobBackground,this.lobBannerViewModel.lobLogo=this.lobLogo):this.bannerViewModel.hideBanner=!0;break;default:this.bannerViewModel.hideBanner=!0}},e.prototype.announceSearchResultsChanged=function(e){var t="";t=e<=0?this.$translate.instant(this.resources.strings.extensibility_apps_list_search_result_update_no_match):1==e?this.$translate.instant(this.resources.strings.extensibility_apps_list_search_result_update_1_match):this.$translate.instant(this.resources.strings.extensibility_apps_list_search_result_update_multiple_matches,{num:e}),this.ariaLiveService.update(t)},e.prototype.showErrorDialog=function(e){this.dialogService.open(this.constants.dialogs.errorDialog,{errorTitle:e,doneButtonMessage:this.$translate.instant(this.resources.strings.apps_gallery_errorDialog_okBtn)})},e.prototype.setFocus=function(e){var t,n=angular.element(".td-apps-gallery-list");e&&(t=angular.element(document.querySelector("#apps-gallery-"+e))),t||(t=n.find(".td-apps-gallery-app")[0]),t&&t.focus()},e.prototype.determineTenantAppsAdminStatus=function(){var e,t=this;this.settingsService.valueAsBoolean(this.constants.settings.names.runningscenariotests)||(e=this.loggingService.newScenario(this.constants.scenarios.setTenantAppsAdminStatusInAppsGallery)),this.enableServiceAdminTenantAppManagement?this.identityService.canUserManageTenantApps("td-apps-gallery").then(function(n){t.userCanManageTenantApps=n,e&&e.stop({userCanManageTenantApps:t.userCanManageTenantApps,valueFrom:"me/settings/canManageLobApps"})}).catch(function(n){t.userCanManageTenantApps=t.identityService.isTenantAdmin(),e&&e.fail({error1:n,error:n,userCanManageTenantApps:t.userCanManageTenantApps,valueFrom:"User Resources Settings isTenantAdmin (skip cache)"})}).finally(function(){t.updateManageAppMenuAndButton()}):this.enableJITTenantAdminLookup?this.identityService.isTenantAdminFromMT("td-apps-gallery").then(function(n){t.userCanManageTenantApps=n,e&&e.stop({userCanManageTenantApps:t.userCanManageTenantApps,valueFrom:"User Resources Settings isTenantAdmin (skip cache)"})}).catch(function(n){t.userCanManageTenantApps=t.identityService.isTenantAdmin(),e&&e.fail({error1:n,error:n,userCanManageTenantApps:t.userCanManageTenantApps,valueFrom:"User Resources Settings isTenantAdmin (skip cache)"})}).finally(function(){t.updateManageAppMenuAndButton()}):(this.userCanManageTenantApps=this.identityService.isTenantAdmin(),this.updateManageAppMenuAndButton(),e&&e.stop({userCanManageTenantApps:this.userCanManageTenantApps,valueFrom:"User Resources Settings isTenantAdmin (cached)"}))},e.prototype.parseOverrideList=function(e){var t=[];if("string"==typeof e){try{e=atob(e),t=JSON.parse(e)}catch(e){t=[]}return t}return e},e.prototype.getCompleteAppListForCategory=function(e,t){var n=this,a=this.getStoreMapCategories(e),i=[];if(_.isEmpty(a))return this.$q.resolve(i);var s=null;_.some(a,function(e){return e.toLowerCase()===g.toLowerCase()})&&(s={all:this.enableNewAppStorePopular?"Alphabetical":"Ranked"});var r=this.appsService.getAppStoreData("apps gallery","Ranked",s,a);return this.$q.all([r,this.getInstalledAppsPromise]).then(function(a){var s=a[0],r=a[1];for(var o in s)s[o]&&(_.forEach(s[o].appList,function(e){if(e&&e.appDefinition&&teamspace.services.AppsServiceUtils.isStoreFrontApp(r,e.appDefinition)){var t=n.isInstalledApp(r,e.appDefinition.id);i.push(n.convertToGalleryViewAppViewModel(e.appDefinition,t,e.ranking))}}),n.storeCategoryMap[o.toLowerCase()]=s[o].appList||[],n.categoryCompletenessMap[o.toLowerCase()]=!0);return i=_.uniqBy(i,"id"),e===A&&(n.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.LOB]=i.slice()),t&&(n.allApps=i,n.sortAndFilterExtensionGalleryItems(e,!1)),i})},e.isFirstTimeVisit=!0,e}();t.TdAppsGalleryController=P,angular.module("teamspace.tdAppsGallery",["teamspace.utilityService"]).directive("tdAppsGallery",["constants","settingsService",function(e,t){return{restrict:"E",scope:{},templateUrl:"components/extensibility/td-apps-gallery/td-apps-gallery-section-with-left-rail.html",controller:P,controllerAs:"tdAppsGallery",bindToController:{params:"="}}}]).directive("scroll",["constants","settingsService","$timeout",function(e,t,n){return{restrict:"A",link:function(a,i,s){if(t.valueAsBoolean(e.settings.names.enableIncrementalScrollForStore)){var r,o=i.closest(".td-apps-gallery"),p={};i.on("scroll",function(e){r||(r=n(function(){var e=o&&o[0]&&angular.element(o[0]).controller("tdAppsGallery");if(e&&e.gridViewModel&&e.gridViewModel.isLoadingMoreApps){var t=document.getElementById("loading-moreapps-indicator");if(t&&t.getBoundingClientRect().bottom-80<=(window.innerHeight||document.documentElement.clientHeight)){var a=e.isCategoryComplete(e.galleryCategory);a||p[e.galleryCategory]||!e.enableUseStoreApi||(e.getCompleteAppListForCategory(e.galleryCategory,!0),p[e.galleryCategory]=!0),e.gridViewModel.increNum++;var i=e.firstPageAppsCount+e.gridViewModel.increNum*e.numberOfAppsToLoadOnScroll;e.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.FILTERED]=e.appDefinitions.slice(0,i),e.gridViewModel.appDefinitions[teamspace.components.GallerySectionFilter.ALL]=e.allApps.slice(0,i),e.gridViewModel.isLoadingMoreApps=!a||i<e.appDefinitions.length}}n.cancel(r),r=null}))}),a.$on("$destroy",function(){i.off("scroll"),r&&n.cancel(r),r=null})}}}}]).run(["$templateCache",function(e){e.put("components/extensibility/td-apps-gallery/td-apps-gallery-section-with-left-rail.html",i),e.put("components/extensibility/td-apps-gallery/td-apps-gallery-banner.html",s),e.put("components/extensibility/td-apps-gallery/td-apps-gallery-grid.html",o),e.put("components/extensibility/td-apps-gallery/td-apps-gallery-upload-options.html",p),e.put("components/extensibility/td-apps-gallery/td-apps-gallery-manage-app-options.html",l),e.put("components/extensibility/td-apps-gallery/td-apps-lob-banner.html",r)}])},2222:function(e,t){e.exports='<div class="td-apps-gallery section with-left-rail" ng-class="{ \'td-apps-gallery-section-with-left-rail-v2\': tdAppsGallery.enableTenantBrandingInStore}" data-tid="apps-gallery">\n  <div class="offline-content" ng-if="tdAppsGallery.networkError">\n    <div class="offline-image">\n      <ng-include src="::tdAppsGallery.offlineImage"></ng-include>\n    </div>\n    <div class="offline-text">\n      <h1>{{::$root.resources.strings.error_message_ClientNetworkOffline|translate}}</h1>\n    </div>\n  </div>\n  <div class="scroll-wrapper-child" ng-if="!tdAppsGallery.networkError" id="scroll-wrapper-child">\n    <section class="td-app-gallery-left-rail" ng-class="{ \'td-app-gallery-left-rail-v2\': tdAppsGallery.enableTenantBrandingInStore, hide: tdAppsGallery.isLoading }" id="td-app-gallery-left-rail">\n      <div class="td-apps-gallery-header">\n        <h2 class="gallery-title">{{::$root.resources.strings.extensibility_apps_store_header|translate}}</h2>\n      </div>\n      <div class="search-and-filter" role="search">\n        \x3c!-- Search Area --\x3e\n        <div class="search">\n          <input sanitized id="app-search-input" ng-model="tdAppsGallery.searchString" class="ts-header-search ts-heading-font ng-valid-maxlength" placeholder="{{::$root.resources.strings.extensibility_apps_gallery_search_all|translate}}" autocapitalize="off" autocorrect="off" autocomplete="off" maxlength="750" ng-change="tdAppsGallery.filterBySearch()">\n          <div class="input-group-btn">\n            <button class="ts-sym icons-search" ng-mousedown="tdAppsGallery.filterBySearch()" data-tid="searchBtn" aria-label="{{::$root.resources.strings.search_placeholderText|translate}}" tabindex="-1">\n              <ng-include src="\'svg/icons-search.html\'"></ng-include>\n            </button>\n          </div>\n        </div>\n      </div>\n      \x3c!-- Category Filter --\x3e\n      <div class="filter-scrollbar-wrapper">\n        <div ng-if="tdAppsGallery.categories.length" class="td-app-gallery-container" role="region" aria-label="{{::$root.resources.strings.extensibility_apps_gallery_category_region|translate}}" simple-scrollbar>\n          <div class="ts-apps-gallery-filter">\n            <div class="td-app-gallery-category-list" acc-role="listgrid-vertical">\n              <ul class="td-app-gallery-category-ul" role="menu">\n                <li class="td-app-gallery-category" aria-labelledby="td-app-gallery-name-{{::category.value}}" aria-pressed="{{!tdAppsGallery.searchString && tdAppsGallery.galleryCategory === category.value}}" aria-current="{{tdAppsGallery.galleryCategory === category.value}}" acc-role="listgrid-item" role="menuitem" title="{{::category.text}}" ng-repeat="category in tdAppsGallery.categories track by category.value" ng-click="tdAppsGallery.changeCategory(category)" ng-keydown="tdAppsGallery.changeCategory(category, $event)" data-tid="td-app-gallery-category-{{::category.value}}" tabindex="{{(tdAppsGallery.galleryCategory === category.value) ? 0 : -1}}" track-click-silent="true">\n                  <div ng-if="category.hasTopPadding" class="category-space"></div>\n                  <div class="category-name" ng-if="!category.isHidden" ng-class="{selected: !tdAppsGallery.searchString && tdAppsGallery.galleryCategory === category.value}">\n                    <div class="text">\n                      <span ng-bind="::category.text" class="category-text" ng-class="{\'selected\': !tdAppsGallery.searchString && tdAppsGallery.galleryCategory === category.value}" id="td-app-gallery-name-{{::category.value}}">\n                      </span>\n                    </div>\n                    <ng-include ng-if="!tdAppsGallery.searchString && tdAppsGallery.galleryCategory === category.value" class="right-align-icon" src="\'svg/icons-patharrow.html\'"></ng-include>\n                  </div>\n                </li>\n              </ul>\n            </div>\n            <div class="category-space"></div>\n            <a class="td-app-gallery-category side-load" href="javascript:void(0)" tabindex="0" id="td-apps-gallery-side-load" ng-if="(tdAppsGallery.sideloadEnabled && !tdAppsGallery.userCanManageTenantApps)" ngf-select="tdAppsGallery.sideloadApp($file)" ng-disabled="tdAppsGallery.wait" ng-model="tdAppsGallery.file" ngf-pattern="\'.zip\'" ngf-accept="\'.zip\'" data-tid="td-app-gallery-sideload-app" acc-role="button listgrid-item" role="button listitem" aria-haspopup="true" title="{{::tdAppsGallery.uploadACustomApp}}">\n              <div class="category-name">\n                <div class="text">\n                  <span class="text" ng-bind="::tdAppsGallery.uploadACustomApp"></span>\n                </div>\n              </div>\n            </a>\n            <div class="td-app-gallery-category" ng-click="tdAppsGallery.showUploadOptions($event)" acc-role="button listgrid-item" role="button listitem" aria-haspopup="true" tabindex="0" title="{{::tdAppsGallery.uploadACustomApp}}" id="td-apps-gallery-side-load" ng-if="tdAppsGallery.userCanManageTenantApps">\n              <div class="category-name">\n                <div class="text">\n                  <span class="text" ng-bind="::tdAppsGallery.uploadACustomApp"></span>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </section>\n    <section class="td-app-gallery-right-rail" ng-class="{ \'td-app-gallery-right-rail-v2\': tdAppsGallery.enableTenantBrandingInStore}" id="right-rail" role="region" aria-label="{{tdAppsGallery.rightRailRegionLabel}}">\n      \x3c!-- Loading Indicator --\x3e\n      <div ng-if="tdAppsGallery.isLoading || tdAppsGallery.isUploading || tdAppsGallery.isDeleting" class="ts-loading-indicator">\n        <busy-animation size="medium" context="apps-gallery"></busy-animation>\n      </div>\n\n      \x3c!--No search Result --\x3e\n      <div class="no-search-result-container" ng-if="tdAppsGallery.appDefinitions.length == 0 && tdAppsGallery.showNoResult">\n        <img class="no-results-image" src="https://statics.teams.cdn.office.net/hashedassets/search_noresults-cb863fb.svg" aria-hidden="true"/>\n        <div class="error-message" aria-label="{{::$root.resources.strings.td_apps_gallery_no_results|translate}}" translate-once="{{::$root.resources.strings.td_apps_gallery_no_results}}"></div>\n      </div>\n\n      \x3c!-- Gallery Items --\x3e\n      <div class="scrollbar-wrapper" id="gallery-apps">\n        <div ng-if="!tdAppsGallery.isLoading && tdAppsGallery.appDefinitions.length" class="td-apps-gallery-container" simple-scrollbar scroll enable-dynamic-adjusting-scrollbar="true">\n          <div class="app-gallery-scroll-wrapper">\n           \x3c!--banner for lob apps--\x3e\n            <ng-include src="\'components/extensibility/td-apps-gallery/td-apps-lob-banner.html\'" onload="lobBannerVm = tdAppsGallery.lobBannerViewModel" ng-if="!tdAppsGallery.searchString && tdAppsGallery.enableLobBanner && tdAppsGallery.showLobBanner">\n            </ng-include>\n            \x3c!--banner for other categories--\x3e\n            <ng-include src="\'components/extensibility/td-apps-gallery/td-apps-gallery-banner.html\'" onload="bannerVm = tdAppsGallery.bannerViewModel" ng-if="!tdAppsGallery.searchString && !tdAppsGallery.showLobBanner">\n            </ng-include>\n\n            \x3c!---- new store ----\x3e\n            \x3c!-- lob apps --\x3e\n            <ng-include src="\'components/extensibility/td-apps-gallery/td-apps-gallery-grid.html\'" onload="gridVm = tdAppsGallery.gridViewModel; key = 2; isSection = true; limit = true; showPublisherInfoInStore = tdAppsGallery.showPublisherInfoInStore" ng-if="tdAppsGallery.enableNewAppStore && tdAppsGallery.enableNewAppStoreLob && tdAppsGallery.galleryCategory==\'All\' && !tdAppsGallery.searchString">\n            </ng-include>\n            \x3c!--- popular apps --\x3e\n            <ng-include src="\'components/extensibility/td-apps-gallery/td-apps-gallery-grid.html\'" onload="gridVm = tdAppsGallery.gridViewModel; key = 4; isSection = true; limit = true; showPublisherInfoInStore = tdAppsGallery.showPublisherInfoInStore" ng-if="tdAppsGallery.enableNewAppStore && tdAppsGallery.enableNewAppStorePopular && tdAppsGallery.galleryCategory==\'All\' && !tdAppsGallery.searchString">\n            </ng-include>\n            \x3c!-- new apps --\x3e\n            <ng-include src="\'components/extensibility/td-apps-gallery/td-apps-gallery-grid.html\'" onload="gridVm = tdAppsGallery.gridViewModel; key = 3; isSection = true; limit = true; showPublisherInfoInStore = tdAppsGallery.showPublisherInfoInStore" ng-if="tdAppsGallery.enableNewAppStore && tdAppsGallery.enableNewAppStoreWhatsNew && tdAppsGallery.galleryCategory==\'All\' && !tdAppsGallery.searchString">\n            </ng-include>\n            \x3c!-- all apps --\x3e\n            <ng-include src="\'components/extensibility/td-apps-gallery/td-apps-gallery-grid.html\'" onload="gridVm = tdAppsGallery.gridViewModel; key = 0; isSection = true; showPublisherInfoInStore = tdAppsGallery.showPublisherInfoInStore" ng-if="tdAppsGallery.enableNewAppStore && (tdAppsGallery.enableNewAppStoreLob || tdAppsGallery.enableNewAppStorePopular || tdAppsGallery.enableNewAppStoreWhatsNew) && tdAppsGallery.galleryCategory==\'All\' && !tdAppsGallery.searchString">\n            </ng-include>\n\n            \x3c!---- old store or filter----\x3e\n            \x3c!-- if none of Lob, Popular, what\'s new section is enabled, we use this one regardless the value of enableNewAppStore --\x3e\n            <ng-include src="\'components/extensibility/td-apps-gallery/td-apps-gallery-grid.html\'" onload="gridVm = tdAppsGallery.gridViewModel; key = 1; isSection = false; showPublisherInfoInStore = tdAppsGallery.showPublisherInfoInStore" ng-if="!tdAppsGallery.enableNewAppStore || !(tdAppsGallery.enableNewAppStoreLob || tdAppsGallery.enableNewAppStorePopular || tdAppsGallery.enableNewAppStoreWhatsNew) || tdAppsGallery.galleryCategory!=\'All\' || tdAppsGallery.searchString">\n            </ng-include>\n          </div>\n        </div>\n      </div>\n    </section>\n  </div>\n</div>'},2223:function(e,t){e.exports='\x3c!-- If template is not used for banner apps in store --\x3e\n<div ng-if="!bannerVm.hideBanner && !tdAppsGallery.showBannerTemplate" ng-class="{\'td-apps-gallery-banner-select\': bannerVm.showLearnMoreButton}" class="td-apps-gallery-banner">\n\n  \x3c!-- left part --\x3e\n  <div class="td-apps-gallery-banner-left">\n    \x3c!-- title / content --\x3e\n    <h2 ng-bind="bannerVm.title" ng-attr-title="{{bannerVm.title}}" class="td-apps-gallery-banner-title">\n    </h2>\n    <div ng-bind="bannerVm.content" ng-attr-title="{{bannerVm.content}}" role="presentation" class="td-apps-gallery-banner-content">\n    </div>\n\n    \x3c!-- learn more button --\x3e\n    <a ng-click="bannerVm.learnMoreButtonClick()" ng-if="bannerVm.showLearnMoreButton" ng-attr-title="{{bannerVm.learnMoreButtonTitle}}" class="td-apps-gallery-banner-btn-more" role="link" tabindex="0">\n      <span ng-bind="bannerVm.learnMoreButtonTitle" class="td-apps-gallery-banner-btn-text">\n      </span>\n      <ng-include src="bannerVm.learnMoreButtonIconSrc" ng-if="bannerVm.learnMoreButtonIconSrc"></ng-include>\n    </a>\n  </div>\n\n  \x3c!-- right part --\x3e\n  <div class="td-apps-gallery-banner-right" ng-class="{\'all\': !bannerVm.imageSrc}">\n    <div class="images" ng-if="!bannerVm.imageSrc">\n      <div class="app-image-container image-{{$index}}" ng-repeat="app in bannerVm.apps | limitTo: 4 track by app.id">\n        <img class="banner-app-image" title="{{::app.name}}" alt="{{::app.name}}" ng-click="bannerVm.onBannerAppClicked(app.id)" ng-src="{{::app.src}}" tabindex="0" fallback-src="{{::tdAppsGallery.appFallbackIcon}}" role="link"/>\n      </div>\n    </div>\n    <img class="banner-image" ng-src="{{bannerVm.imageSrc}}" ng-if="bannerVm.imageSrc" fallback-src="{{::tdAppsGallery.appFallbackIcon}}"/>\n  </div>\n</div>\n\n\x3c!-- If template is used for banner apps in store --\x3e\n<div ng-if="!bannerVm.hideBanner && tdAppsGallery.showBannerTemplate" ng-class="{\'td-apps-gallery-banner-select\': bannerVm.showLearnMoreButton}" class="td-apps-gallery-banner-template" style="background-image: url(\'{{::bannerVm.backgroundSrc}}\')">\n\n  \x3c!-- left part --\x3e\n  <div class="td-apps-gallery-banner-left-template">\n    \x3c!-- title / content --\x3e\n    <h2 ng-bind="bannerVm.title" ng-attr-title="{{bannerVm.title}}" class="td-apps-gallery-banner-title-template">\n    </h2>\n    <div ng-bind="bannerVm.subtitle1" ng-attr-title="{{bannerVm.subtitle1}}" role="presentation" class="td-apps-gallery-banner-subtitle1-template">\n    </div>\n    <div ng-bind="bannerVm.subtitle2" ng-attr-title="{{bannerVm.subtitle2}}" role="presentation" class="td-apps-gallery-banner-subtitle1-template">\n    </div>\n\n    \x3c!-- learn more button --\x3e\n    <a ng-click="bannerVm.learnMoreButtonClick()" ng-if="bannerVm.showLearnMoreButton" ng-attr-title="{{bannerVm.learnMoreButtonTitle}}" class="td-apps-gallery-banner-btn-more-template" role="link" tabindex="0">\n      <span ng-bind="bannerVm.learnMoreButtonTitle" class="td-apps-gallery-banner-btn-text-template">\n      </span>\n    </a>\n  </div>\n\n  \x3c!-- right part --\x3e\n  <div class="td-apps-gallery-banner-right-template" ng-class="{\'all\': !bannerVm.imageSrc}">\n    <div class="app-image-container-template image-{{$index}}" ng-repeat="app in bannerVm.apps | limitTo: 4 track by app.id">\n      <img class="banner-app-image-template" title="{{::app.name}}" alt="{{::app.name}}" ng-click="bannerVm.onBannerAppClicked(app.id)" ng-src="{{::app.src}}" tabindex="0" fallback-src="{{::tdAppsGallery.appFallbackIcon}}" role="link"/>\n    </div>\n    <img class="banner-image" ng-src="{{bannerVm.imageSrc}}" ng-if="bannerVm.imageSrc" fallback-src="{{::tdAppsGallery.appFallbackIcon}}"/>\n  </div>\n</div>'},2224:function(e,t){e.exports='\x3c!-- If template is used for banner apps in store --\x3e\n<div ng-if="tdAppsGallery.showLobBanner" class="td-apps-gallery-lob-banner" ng-style="lobBannerVm.lobBackground && ((tdAppsGallery.isUrl && tdAppsGallery.isBackgroundLoaded && {\'background-image\': \'url({{lobBannerVm.lobBackground}})\'}) || (!tdAppsGallery.isUrl && {\'background\': lobBannerVm.lobBackground}))">\n  \x3c!-- left part --\x3e\n  <div class="td-apps-gallery-lob-banner-left">\n    \x3c!-- title / content --\x3e\n    <h2 ng-bind="lobBannerVm.lobTitle" ng-attr-title="{{lobBannerVm.lobTitle}}" ng-if="!tdAppsGallery.isBackgroundLoaded" class="td-apps-gallery-lob-banner-title-default">\n    </h2>\n    <h2 ng-bind="lobBannerVm.lobTitle" ng-attr-title="{{lobBannerVm.lobTitle}}" class="td-apps-gallery-lob-banner-title" ng-if="tdAppsGallery.isBackgroundLoaded" style="color: {{lobBannerVm.lobTextColor}}">\n    </h2>\n  </div>\n  \x3c!-- right part --\x3e\n  <div class="td-apps-gallery-lob-banner-right">\n    <img class="banner-image" ng-src="{{lobBannerVm.lobLogo}}" ng-if="lobBannerVm.lobLogo && tdAppsGallery.isLogoLoaded" title="{{::$root.resources.strings.extensibility_apps_gallery_banner_cat_lob_apps_logo | translate}}" alt="{{::$root.resources.strings.extensibility_apps_gallery_banner_cat_lob_apps_logo | translate}}"/>\n  </div>\n</div>'},2225:function(e,t){e.exports='<div class="td-apps-gallery-section" ng-if="gridVm.appDefinitions[key] && gridVm.appDefinitions[key].length > 0">\n  <div class="td-apps-gallery-list-header" ng-if="isSection" ng-attr-data-tid="{{::(\'td-apps-gallery-section-header-\' + key)}}">\x3c!-- don\'t show header if it has search or filter--\x3e\n    <div class="td-apps-gallery-lob-logo-mark" ng-if="gridVm.lobLogomark && tdAppsGallery.enableLobBanner && tdAppsGallery.enableUseStoreApi && key === 2 ">\n      <img class="lob-logomark-image" ng-src="{{gridVm.lobLogomark}}" fallback-src="{{::gridVm.appFallbackIcon}}"/>\n    </div>\n    <span class="td-apps-gallery-list-header-text">\n      {{::gridVm.sectionNames[key]}}\n    </span>\n    <span class="td-apps-gallery-see-more-text" ng-if="key!=0" ng-class="{\'hasButton\': key!=1}" tabindex="0" ng-click="gridVm.goToSection(key)" ng-attr-data-tid="{{::(\'td-apps-gallery-section-header-see-more-\' + key)}}" aria-label="{{::gridVm.sectionNames[key]}}">\n      {{::$root.resources.strings.extensibility_store_see_all|translate}}\n    </span>\n  </div>\n  \x3c!-- grid --\x3e\n  <div class="td-apps-gallery-list" acc-role="listgrid-horizontal-and-vertical" role="menu">\n    \x3c!-- App tiles; if it\'s LOB/what\'s new section then only show first 8 apps --\x3e\n    <div class="td-apps-gallery-app" ng-class="{ \'td-apps-placeholder\': gridVm.isUpdating && gridVm.selectedAppId }" ng-attr-aria-labelledby="{{ showPublisherInfoInStore ? \'apps-gallery-name-\' + definition.id + \' app-aria-suffix-\' + definition.id + \' apps-gallery-developer-name-\' + definition.id : \'apps-gallery-name-\' + definition.id + \' app-aria-suffix-\' + definition.id + \' apps-gallery-type-\' + definition.id }}" aria-describedby="apps-gallery-description-{{::definition.id}} tenant-app-management-aria-label-{{::definition.id}}" acc-role="listgrid-item focus-default" role="menuitem" ng-disabled="gridVm.isInlineDeleting" tabindex="{{$first ? 0 : -1}}" ng-repeat="definition in (limit && tdAppsGallery.sectionAppNum ? gridVm.appDefinitions[key].slice(0 , tdAppsGallery.sectionAppNum) : gridVm.appDefinitions[key]) track by definition.id" ng-click="gridVm.onAppClicked(definition, false, key)" ts-right-click="gridVm.showManageAppOptions(definition.id, $event)" id="apps-gallery-{{::definition.id}}" data-tid="apps-gallery-{{::definition.id}}" track-click-silent="true">\n      <div class="ts-loading-indicator td-apps-gallery-loader" ng-if="gridVm.isInlineDeleting && gridVm.selectedAppId == definition.id">\n        <busy-animation size="medium" context="apps-gallery"></busy-animation>\n      </div>\n      <div class="td-apps-gallery-app-area" ng-if="!gridVm.isUpdating || gridVm.selectedAppId !== definition.id">\n        <button class="ts-sym icons-more app-icons-fill-hover show-icon-on-hover manage-app-options" ng-click="gridVm.showManageAppOptions(definition.id, $event)" tabindex="-1" data-tid="manage-gallery-app-{{::definition.id}}">\n          <ng-include src="\'svg/icons-more.html\'"></ng-include>\n        </button>\n        <div class="td-apps-gallery-info">\n          <div class="image-container">\n            <span class="image-background" ng-style="{ \'background\': definition.accentColor }">\n              <ng-include src="definition.icon" ng-if="::gridVm.useNgIncludeForIcon(definition.icon)">\n              </ng-include>\n              <img role="img" alt="{{::($root.resources.strings.extensibility_app_icon_alt|translate:{appName:definition.name})}}" aria-label="{{::($root.resources.strings.extensibility_app_icon_alt|translate:{appName:definition.name})}}" ng-src="{{::definition.icon}}" fallback-src="{{::gridVm.appFallbackIcon}}" ng-if="::!gridVm.useNgIncludeForIcon(definition.icon)"/>\n            </span>\n          </div>\n          <div class="td-apps-gallery-app-name">\n            <span class="app-name" dir="auto" title="{{::definition.name}}" ng-bind="::definition.name" id="apps-gallery-name-{{::definition.id}}">\n            </span>\n            <span class="app-description" ng-if="!showPublisherInfoInStore" title="{{::definition.category}}" ng-bind="::definition.category" id="apps-gallery-type-{{::definition.id}}">\n            </span>\n            <span class="app-description" ng-if="showPublisherInfoInStore" title="{{::definition.developerName}}" ng-bind="::definition.developerName" id="apps-gallery-developer-name-{{::definition.id}}">\n            </span>\n          </div>\n        </div>\n        <div class="td-apps-gallery-app-description">\n          <span class="app-description" dir="auto" title="{{::definition.description}}" ng-bind="::definition.description" id="apps-gallery-description-{{::definition.id}}">\n          </span>\n        </div>\n        <div class="hidden" id="tenant-app-management-aria-label-{{::definition.id}}" aria-label="{{::$root.resources.strings.extensibility_apps_store_app_management_option|translate}}">\n        </div>\n        <div class="hidden" id="app-aria-suffix-{{::definition.id}}" aria-label="{{::$root.resources.strings.extensibility_apps_store_app_tile_label|translate}}">\n        </div>\n      </div>\n      <div class="ts-loading-indicator" ng-if="gridVm.isUpdating && gridVm.selectedAppId === definition.id">\n        <busy-animation size="medium" context="apps-gallery"></busy-animation>\n      </div>\n    </div>\n    \x3c!-- these empty blocks is to handle the flex-grow for last row --\x3e\n    <div class="empty"></div>\n    <div class="empty"></div>\n    <div class="empty"></div>\n    <div class="empty"></div>\n    <div class="empty"></div>\n    <div class="empty"></div>\n    \x3c!-- Loading Indicator: only shows up if it\'s not LOB/What\'s new section and app size is exceed limit--\x3e\n    <div ng-if="!limit && gridVm.isLoadingMoreApps" id="loading-moreapps-indicator" class="ts-loading-indicator">\n      <busy-animation size="medium" context="apps-gallery"></busy-animation>\n    </div>\n  </div>\n</div>\n'},2226:function(e,t){e.exports='<div class="popover link-more-actions app-default-menu minwidth-sm maxwidth-sm" id="app-upload-menu" data-tid="app-upload-menu" outside-click="tdAppsGallery.dismissUploadAppPopover()" role="region" aria-label="{{::$root.resources.strings.extensibility_apps_gallery_upload_app_label|translate}}" set-aria-pos>\n  <ul acc-role="dialog menu" class="app-default-menu-ul set-aria-attribute">\n    <li role="menuitem">\n      <button class="ts-sym has-icon" ng-if="tdAppsGallery.sideloadEnabled" ngf-select="tdAppsGallery.sideloadApp($file)" ng-disabled="tdAppsGallery.appActionDisabled()" ng-model="tdAppsGallery.file" ngf-pattern="\'.zip\'" ngf-accept="\'.zip\'" acc-role="menu-item focus-default" title="{{::$root.resources.strings.extensibility_apps_gallery_upload_option_sideload|translate}}" track-click-silent="true" data-tid="side-load-app">\n        <div>\n          <ng-include class="icon" src="\'svg/icons-files-upload.html\'"></ng-include>\n          <span>{{::$root.resources.strings.extensibility_apps_gallery_upload_option_sideload|translate}}</span>\n        </div>\n      </button>\n    </li>\n    <li role="menuitem" ng-if="tdAppsGallery.enableTenantOwnedApps">\n      <button class="ts-sym has-icon" ngf-select="tdAppsGallery.uploadTenantApp($file)" ng-disabled="tdAppsGallery.appActionDisabled()" ng-model="tdAppsGallery.file" ngf-pattern="\'.zip\'" ngf-accept="\'.zip\'" acc-role="menu-item" title="{{tdAppsGallery.uploadATenantApp}}" track-click-silent="true" data-tid="upload-tenant-app">\n        <div>\n          <ng-include class="icon" src="\'svg/icons-files-upload.html\'"></ng-include>\n          <span ng-bind="tdAppsGallery.uploadATenantApp"></span>\n        </div>\n      </button>\n    </li>\n  </ul>\n</div>\n'},2227:function(e,t){e.exports='<div class="popover link-more-actions app-default-menu minwidth-sm maxwidth-sm" id="app-{{tdAppsGallery.selectedAppId}}-manageAppMenu" outside-click="tdAppsGallery.dismissManageAppPopover()" role="region" aria-label="{{::$root.resources.strings.extensibility_apps_gallery_manage_app_label|translate}}" set-aria-pos>\n  <ul acc-role="dialog menu" class="app-default-menu-ul set-aria-attribute">\n    <li acc-role="menu-item focus-default" ng-if="tdAppsGallery.showManageAppButton">\n      <button class="ts-sym has-icon" ngf-select="tdAppsGallery.updateTenantApp($file)" ng-disabled="tdAppsGallery.appActionDisabled()" ng-model="tdAppsGallery.file" ngf-pattern="\'.zip\'" ngf-accept="\'.zip\'" title="{{::$root.resources.strings.extensibility_apps_gallery_update_app_option|translate}}" track-click-silent="true" data-tid="update-tenant-app-{{tdAppsGallery.selectedAppId}}">\n        <div>\n          <ng-include class="icon" src="\'svg/icons-files-upload.html\'"></ng-include>\n          <span>{{::$root.resources.strings.extensibility_apps_gallery_update_app_option|translate}}</span>\n        </div>\n      </button>\n    </li>\n    <li acc-role="menu-item focus-default">\n      <button class="ts-sym has-icon" ng-click="$parent.$hide(); tdAppsGallery.copyLinkToApp($event)" ng-disabled="tdAppsGallery.appActionDisabled()" title="{{::$root.resources.strings.extensibility_apps_gallery_sharing_copyLink_title|translate}}" track-click-silent="true" data-tid="share-app-{{tdAppsGallery.selectedAppId}}">\n        <div>\n          <ng-include class="icon" src="\'svg/icons-link.html\'"></ng-include>\n          <span>{{::$root.resources.strings.extensibility_apps_gallery_sharing_copyLink_title|translate}}</span>\n        </div>\n      </button>\n    </li>\n    <li acc-role="menu-item" ng-if="tdAppsGallery.showManageAppButton">\n      <button class="ts-sym has-icon" ng-click="tdAppsGallery.deleteTenantApp()" ng-disabled="tdAppsGallery.appActionDisabled()" title="{{::$root.resources.strings.extensibility_apps_gallery_delete_app_option|translate}}" track-click-silent="true" data-tid="delete-tenant-app-{{tdAppsGallery.selectedAppId}}">\n        <div>\n          <ng-include class="icon" src="\'svg/icons-delete.html\'"></ng-include>\n          <span>{{::$root.resources.strings.extensibility_apps_gallery_delete_app_option|translate}}</span>\n        </div>\n      </button>\n    </li>\n  </ul>\n</div>\n'},2228:function(e,t,n){"use strict";var a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(2229),s=function(){function e(e,t,n,a,i,s,r,o,p,l,c,d,g,u,h,m,y,f,A,b,v,S){var _=this;if(this.$state=e,this.$filter=t,this.$q=n,this.$translate=a,this.$timeout=i,this.analyticsService=s,this.appsService=r,this.constants=p,this.dialogService=l,this.extensionManifestService=c,this.helpService=d,this.loggingService=g,this.peopleSlugService=h,this.resources=m,this.routeUtilityService=y,this.utilityService=S,this.learnMoreUrl="https://aka.ms/microsoftteamsplatform",this.enableAppUpgradeInChat=!1,this.isGuestUser=!1,this.isChat=!1,this.scenarioName=p.scenarios.teamDashboard.appsTabLoad,this.logger=g.newLogger("AppsTab"),this.enableInstallChatAppsFromStore=f.valueAsBoolean(p.settings.names.enableInstallChatAppsFromStore),this.enableSideloadAppByZip=f.valueAsBoolean(p.settings.names.enableSideloadAppByZip),this.stateParams=y.getRootRouteParams(),this.isChat=this.stateParams&&this.stateParams.peopleSlug&&this.stateParams.ctx===p.navigation.context.chat,this.appFallbackIcon=p.fallbackImages.appFallbackImage,this.teamAndChannelPromise=this.isChat?void 0:o.resolveTeamAndChannel(y.getRootRouteParams().threadId).then(function(e){_.teamId=e.team.objectId,_.isTeamArchived=e.team.isArchived&&f.valueAsBoolean(p.settings.names.enableTeamArchive);var t=b.isAdmin(_.teamId);if(_.canInstallApp=!_.isTeamArchived&&(t||v.canAddApp(_.teamId)),_.canUninstallApp=!_.isTeamArchived&&(t||v.canRemoveApp(_.teamId)),_.enableAppUpgradeNotification=_.canInstallApp&&f.valueAsBoolean(p.settings.names.enableAppUpgradeNotification),f.valueAsBoolean(p.settings.names.enableSideloadingEnforcement)){var n;f.valueAsBoolean(p.settings.names.runningscenariotests)||(n=g.newScenario(p.scenarios.extensibility.apps.tab.toggleSideloadEntrypoint)),r.getUserAppPolicy("apps tab - team").then(function(e){var a=!(!e||!e.isSideloadingAllowed)&&e.isSideloadingAllowed,i=v.canUploadCustomApp(_.teamId);_.canSideloadApp=a&&(t||i),n&&n.stop({isTeamAdmin:t,teamAllowsCustomUploads:i,sideloadingAllowedByPolicy:e&&void 0!=e.isSideloadingAllowed?e.isSideloadingAllowed:void 0,sideloadingEntrypointIsVisible:_.canSideloadApp})}).catch(function(e){_.canSideloadApp=!1,n&&n.fail({sideloadingEntrypointIsVisible:_.canSideloadApp,error:e,error1:e})})}else _.canSideloadApp=A.getSettingValue(SkypeX.Services.TenantSettingsStorageKey.isSideLoadedAppsEnabled);_.isOutgoingWebhookAppAllowed(_.teamId).then(function(e){_.canCreateOutgoingWebhook=e})}),this.isChat)if(f.valueAsBoolean(p.settings.names.enableSideloadingEnforcement)){var I;f.valueAsBoolean(p.settings.names.runningscenariotests)||(I=g.newScenario(p.scenarios.extensibility.apps.tab.toggleSideloadEntrypoint)),r.getUserAppPolicy("apps tab - chat").then(function(e){_.canSideloadApp=!(!e||!e.isSideloadingAllowed)&&e.isSideloadingAllowed,I&&I.stop({sideloadingAllowedByPolicy:e&&void 0!=e.isSideloadingAllowed?e.isSideloadingAllowed:void 0,sideloadingEntrypointIsVisible:_.canSideloadApp})}).catch(function(e){_.canSideloadApp=!1,I&&I.fail({sideloadingEntrypointIsVisible:_.canSideloadApp,error:e,error1:e})})}else this.canSideloadApp=A.getSettingValue(SkypeX.Services.TenantSettingsStorageKey.isSideLoadedAppsEnabled);this.isChat&&this.enableInstallChatAppsFromStore&&(this.chatId=this.getChatId(),this.canInstallApp=!0,this.canUninstallApp=!0,this.enableAppUpgradeInChat=f.valueAsBoolean(p.settings.names.enableChatAppUpgrade)),this.discoverButtonSrc="svg/icons-discover-apps.html",this.noAppsStr=a.instant(m.strings.team_dashboard_developer_noapps_subtitle_discover_new),this.appButtonText=a.instant(m.strings.extensibility_go_to_store),this.wait=this.isWaiting(),this.isGuestUser=this.enableInstallChatAppsFromStore&&this.isChat&&u.isGuestUserType(),this.buildTable()}return e.$inject=["$state","$filter","$q","$translate","$timeout","analyticsService","appsService","channelService","constants","dialogService","extensionManifestService","helpService","loggingService","identityService","peopleSlugService","resources","routeUtilityService","settingsService","tenantSettingsStore","teamMembershipPropertiesService","teamSettingsService","utilityService"],e.prototype.buildTable=function(){var e=this;this.getAppsFromAppsService().then(function(t){e.appList=t,e.sortedColumn||(e.sortedColumn={name:"name"}),e.sortTableInternal()}).catch(function(t){e.handleError(t,"Failed to get the apps list")}).finally(function(){e.wait=e.isWaiting()})},e.prototype.getAppsFromAppsService=function(){var e=this;return this.isChat&&this.enableInstallChatAppsFromStore?this.appsService.getInstalledAppsForGroupChat(this.chatId).then(function(t){return e.getAppsFromEntitlements(t)}):this.teamAndChannelPromise.then(function(){return e.appsService.getInstalledAppsForTeam(e.teamId).then(function(t){return e.getAppsFromEntitlements(t)})})},e.prototype.getAppsFromEntitlements=function(e){if(!e||e.length<1)return[];for(var t=[],n=0;n<e.length;n++){var a=e[n];if(teamspace.services.AppsServiceUtils.isAppInstalled(a)&&!teamspace.services.AppsServiceUtils.isAppPermanentForDiscoverability(a)){var i=a.appDefinition.name;a.appDefinition.customBots&&a.appDefinition.customBots.length?i=this.$translate.instant(this.resources.strings.td_apps_tab_name_customBot,{name:i}):this.appsService.isSideloadedApp(a.appDefinition)&&(i=this.$translate.instant(this.resources.strings.td_apps_tab_name_sideloaded_app,{name:i}));var s=this.teamId?this.enableAppUpgradeNotification&&this.appsService.isUpgradeConsentRequired(a.appDefinition.id,this.teamId):this.enableAppUpgradeInChat&&this.appsService.isUpgradeConsentRequired(a.appDefinition.id,this.chatId);t.push({id:a.appDefinition.id,name:i,description:a.appDefinition.longDescription,icon:a.appDefinition.largeImageUrl,smallIcon:a.appDefinition.smallImageUrl,accentColor:a.appDefinition.accentColor,hasCustomBots:!!a.appDefinition.customBots,hasBots:!!a.appDefinition.bots,hasTabs:!!a.appDefinition.galleryTabs,externalId:a.appDefinition.externalId,upgradeConsentRequired:s,tenantId:a.appDefinition.tenantId})}}return t},e.prototype.isOutgoingWebhookAppAllowed=function(e){var t=this,n=this.logger.service.newScenario(this.constants.scenarios.extensibility.apps.tab.toggleCreateOutgoingWebhookEntrypoint);return this.appsService.isOutgoingWebhookAppAllowed(e).then(function(a){return t.logger.info("teamId: "+e+", isOutgoingWebhookAppAllowed: "+a),n.eventData.isOutgoingWebhookAppAllowed=a,a}).catch(function(e){return t.logger.error("isOutgoingWebhookAppAllowed: Check isOutgoingWebhookAppAllowed from appsService failed."),n.fail({isOutgoingWebhookAppAllowed:!0,error:JSON.stringify(teamspace.services.AppsServiceUtils.getSafeError(e)),error2:JSON.stringify(teamspace.services.AppsServiceUtils.getSafeError(e))}),!0}).finally(function(){n.stop()})},e.prototype.getChatId=function(){if(this.stateParams.peopleSlug&&this.stateParams.ctx===this.constants.navigation.context.chat){var e=this.peopleSlugService.resolve(this.stateParams.peopleSlug);return e&&e.conversation&&e.conversation.id}return null},e.prototype.isWaiting=function(){return!(this.errorInfo||this.appList&&(this.teamId||this.chatId))},e.prototype.sortTable=function(e){this.sortedColumn&&e==this.sortedColumn.name?this.sortedColumn.reverse=!this.sortedColumn.reverse:this.sortedColumn={name:e},this.sortTableInternal()},e.prototype.sortTableInternal=function(){this.appList=this.$filter("orderBy")(this.appList,this.sortedColumn.name,this.sortedColumn.reverse)},e.prototype.sideloadApp=function(e){var t=this;if(e){var n=this.isChat&&this.enableInstallChatAppsFromStore;this.wait=!0;var a=n?this.logger.service.newScenario(this.constants.scenarios.extensibility.apps.chat.processSideloadedManifest):this.logger.service.newScenario(this.constants.scenarios.extensibility.tabs.framework.sideloadAppToTeamScenario);this.logger.info("Starting upload of tab definition"),this.errorInfo=null;var i;this.$q.all([this.extensionManifestService.extractAppDefinition(e,this.enableSideloadAppByZip)]).then(function(a){i=a[0];var s=t.$q.defer(),r=n?{entryPoint:teamspace.components.AddAppDialogEntryPoint.AppsManagementTabFromGroupChatSideload,manifestZipFile:e,chatId:t.chatId}:{entryPoint:teamspace.components.AddAppDialogEntryPoint.AppsManagementTabFromTeamSideload,manifestZipFile:e,teamId:t.teamId};return t.dialogService.openLazyDialog(t.constants.lazyDialogs.addAppNew,t.constants.lazyModules.extensibilityDialogs,r,function(e){e&&e.installSucceeded||"$document"===e||"$closeButton"===e||"$escKey"===e?s.resolve():s.reject()}),s.promise}).then(function(){a.stop()}).catch(function(e){if(e&&e.type===t.constants.extensibility.apps.errorCodes.manifestError)a.cancel({error:e.errors}),t.handleError(e.errors,"Failed to validate app manifest");else if(e&&e.data&&e.data.errorCode===t.constants.extensibility.apps.errorCodes.chatBotsRosterLimitExceeded){var n=t.$translate.instant(t.resources.strings.chats_apps_sideload_bot_roster_limit);a.fail({error:e}),t.handleError(n,"Failed to upload app package")}else e&&e.data&&e.data.errorCode===t.constants.extensibility.apps.errorCodes.unableToParseTeamsAppManifest?(a.cancel({error:e}),t.handleManifestParseError(e.data.message)):(a.fail({error:e}),t.handleError(e,"Failed to upload app package",i&&i.name?i.name:void 0))}).finally(function(){t.buildTable()})}},e.prototype.openAppDetails=function(e){var t=this;if(e.hasCustomBots)this.loggingService.newScenario(this.constants.scenarios.extensibility.customBots.openAddWebhookDialog).clientId="td-apps-tab",this.dialogService.registerCloseCallback(this.constants.dialogs.addWebhook,function(e){e&&e.installSucceeded&&t.buildTable()}),this.dialogService.open(this.constants.dialogs.addWebhook,{teamId:this.teamId,webhookId:e.id,editMode:!0});else{var n=this.logger.service.newScenario(this.constants.scenarios.extensibility.tabs.framework.openAppDetailsScenario);n.eventData=this.getScenarioEventData(e);var a={appID:e.id,intent:this.isChat?teamspace.components.AddAppDialogIntent.GroupChat:teamspace.components.AddAppDialogIntent.Team,chatId:this.chatId,preselectChat:this.chatId,teamId:this.teamId,preselectTeam:this.teamId,action:(this.enableAppUpgradeNotification||this.enableAppUpgradeInChat)&&e.upgradeConsentRequired?teamspace.components.AddAppDialogAction.Consent:teamspace.components.AddAppDialogAction.View,autoNavigationOnDone:!0,source:"td-apps-tab"},i=void 0;i=this.isChat?(this.enableAppUpgradeNotification||this.enableAppUpgradeInChat)&&e.upgradeConsentRequired?{entryPoint:teamspace.components.AddAppDialogEntryPoint.GroupChatAppsManagementUpgrade,appId:e.id,chatId:this.chatId}:{entryPoint:teamspace.components.AddAppDialogEntryPoint.GroupChatAppsManagementView,appId:e.id,chatId:this.chatId}:(this.enableAppUpgradeNotification||this.enableAppUpgradeInChat)&&e.upgradeConsentRequired?{entryPoint:teamspace.components.AddAppDialogEntryPoint.AppsManagementTabUpgrade,appId:e.id,teamId:this.teamId}:{entryPoint:teamspace.components.AddAppDialogEntryPoint.AppsManagementTabView,appId:e.id,teamId:this.teamId};var s;e.upgradeConsentRequired&&(s=function(e){e&&e.upgradeSucceeded&&t.buildTable()}),this.dialogService.openLazyDialog(this.constants.lazyDialogs.addAppNew,this.constants.lazyModules.extensibilityDialogs,Object.assign(a,i),s),n.stop()}},e.prototype.openAppGallery=function(){var e=this.logger.service.newScenario(this.constants.scenarios.extensibility.tabs.framework.openAppGalleryScenario),t={intent:this.isChat?teamspace.components.AddAppDialogIntent.GroupChat:teamspace.components.AddAppDialogIntent.Team,category:teamspace.services.AppsServiceCategoryFilter.All,threadId:this.isChat?this.routeUtilityService.getRootRouteParams().peopleSlug:this.routeUtilityService.getRootRouteParams().threadId,autoNavigationOnDone:!0,skipInstalledSuccess:!1,preselectTeam:this.teamId,preselectChat:this.chatId,addAppDialogEntryPoint:this.isChat?teamspace.components.AddAppDialogEntryPoint.AppsManagementTabFromGroupChat:teamspace.components.AddAppDialogEntryPoint.AppsManagementTabFromTeam};this.$state.go(this.constants.states.appApps,t).catch(function(n){e.fail({source:"td-apps-tab",params:JSON.stringify(t),error:n})}).finally(function(){e.stop()})},e.prototype.deleteApp=function(e,t){var n=this;e.stopPropagation();var i=this.appList[t];if(i){var s={closeButtonText:this.$translate.instant(this.resources.strings.extension_uninstallConfirmCloseText),okButtonText:this.$translate.instant(this.resources.strings.extension_uninstallConfirmOkText),confirmMessageTitle:this.$translate.instant(this.resources.strings.extension_uninstallConfirmTitle,{name:i.name}),confirmMessageHtmlBody:this.$translate.instant(this.resources.strings.extension_uninstallConfirmMessage,{name:i.name}),clickSilent:!0,callback:function(){var e=n.logger.service.newScenario(n.constants.scenarios.extensibility.tabs.framework.deleteAppFromTeamScenario);n.logger.info("Starting deletion of tab definition"),n.errorInfo=null,n.appList.splice(t,1),n.$timeout(function(){n.setFocus(t)}),n.wait=!0,(n.isChat&&n.enableInstallChatAppsFromStore?n.appsService.deleteGroupChatAppEntitlement(n.chatId,i.id):n.appsService.deleteTeamAppEntitlement(n.teamId,i.id)).then(function(){n.setFocus(t),e.stop(),n.logTelemetryForDeleteAppAction(i)}).catch(function(t){n.buildTable(),e.fail(a({},n.getScenarioEventData(i),{error:t})),t&&t.type===n.constants.extensibility.apps.errorCodes.amsError?n.handleError(t,"Failed to remove image from ams, appId: "+i.id):n.handleError(t,"Failed to uninstall app, appId: "+i.id,i.name)}).finally(function(){n.wait=!1})}};this.dialogService.open(this.constants.dialogs.confirmDialog,s)}},e.prototype.goToLearnMore=function(){this.helpService.gotoHelp("Articles-UsingAppsServicesPluginsWithSkypeTeams/6c25661b-90f8-4b52-92b2-1fcd3e5d946c")},e.prototype.addOutgoingWebhook=function(){var e=this;this.loggingService.newScenario(this.constants.scenarios.extensibility.customBots.openAddWebhookDialog).clientId="td-apps-tab",this.dialogService.registerCloseCallback(this.constants.dialogs.addWebhook,function(t){t&&t.installSucceeded&&e.buildTable()}),this.dialogService.open(this.constants.dialogs.addWebhook,{teamId:this.teamId})},e.prototype.handleError=function(e,t,n){var a=t+". Error: ";"string"==typeof e?(a+=e,this.errorInfo=e):e&&e.data&&e.data.errorCode===this.constants.extensibility.apps.errorCodes.appSideloadingForbidden?(a+=JSON.stringify(e),this.errorInfo=this.$translate.instant(this.resources.strings.extension_appSideloadingForbiddenErrorMessage)):e&&e.data&&e.data.errorCode===this.constants.extensibility.apps.errorCodes.userNotAuthorizedToRevokeResourceSpecificPermissions?(a+=JSON.stringify(e),this.errorInfo=this.$translate.instant(this.resources.strings.extension_addAppDialog_Permission_RSC_Error_Delete_App_Team,{appName:n})):e&&e.data&&(e.data.errorCode===this.constants.extensibility.apps.errorCodes.userNotAuthorizedToModifyResourceSpecificPermissions||e.data.errorCode===this.constants.extensibility.apps.errorCodes.RscPermissionsWriteFailed||e.data.errorCode===this.constants.extensibility.apps.errorCodes.resourceSpecificPermissionsMismatch)?(a+=JSON.stringify(e),this.errorInfo=this.$translate.instant(this.resources.strings.extension_addAppDialog_Permission_RSC_Error_Upgrade_App_Team,{appName:n})):e&&e.data&&(e.data.errorCode===this.constants.extensibility.apps.errorCodes.userNotAuthorizedToGrantResourceSpecificPermissions||e.data.errorCode===this.constants.extensibility.apps.errorCodes.appInstalledButRscGrantFailed||e.data.errorCode===this.constants.extensibility.apps.errorCodes.resourceSpecificPermissionsMismatch)?(a+=JSON.stringify(e),this.errorInfo=this.$translate.instant(this.resources.strings.extension_addAppDialog_Permission_RSC_Error_Add_App_Team,{appName:n})):(a+=JSON.stringify(e),this.errorInfo=this.$translate.instant(this.resources.strings.td_apps_tab_error)),this.logger.error(a)},e.prototype.handleManifestParseError=function(e){this.dialogService.openLazyDialog(this.constants.lazyDialogs.manifestError,this.constants.lazyModules.extensibilityDialogs,{errorMessage:this.$translate.instant(this.resources.strings.extension_addAppDialogManifestParsingErrorMessage),errorDetails:e})},e.prototype.setFocus=function(e){var t;(t=this.appList.length>0&&this.appList.length>=e?angular.element(".td-apps-container").find(".td-apps")[this.appList.length===e?e-1:e]:angular.element(".left-action-btns").find("[data-tid='td-apps-gallery']"))&&t.focus()},e.prototype.logTelemetryForDeleteAppAction=function(e){var t=this,n={action:{gesture:teamspace.components.PanelActionGesture.click,outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.submit.toString(),teamspace.components.PanelActionOutcome,this.loggingService),scenario:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenario.removeAppDialog.toString(),teamspace.components.PanelActionScenario,this.loggingService),scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.appMgmt.toString(),teamspace.components.PanelActionScenarioType,this.loggingService)},module:{name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.confirmRemoveApp.toString(),teamspace.components.PanelModuleName,this.loggingService),type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.button.toString(),teamspace.components.PanelModuleType,this.loggingService),summary:this.isChat?"Delete "+e.name+" from chat":"Delete "+e.name+" from team"},app:{id:e.id,name:e.name}};this.analyticsService.getAnalyticsPanelActionEventData(n).then(function(e){t.analyticsService.sendPanelAction(e)})},e.prototype.getScenarioEventData=function(e){return{appId:e.id,externalId:e.externalId,tenantId:e.tenantId,isChat:this.isChat}},e}();t.TdAppsTabController=s,angular.module("teamspace.tdAppsTab",["teamspace.utilityService","teamspace.routeUtilityService"]).run(["$templateCache",function(e){e.put("components/extensibility/td-apps-tab/td-apps-tab.html",i)}]).directive("tdAppsTab",[function(){return{restrict:"E",scope:{},bindToController:{},templateUrl:"components/extensibility/td-apps-tab/td-apps-tab.html",controller:s,controllerAs:"tdct"}}])},2229:function(e,t){e.exports='<div class="td-apps-tab team-dashboard-tab flex-fill">\n    <div class="manage-apps-title" ng-if="tdct.isChat" ng-bind="::$root.resources.strings.chat_manage_apps | translate"></div>\n    <div class="user-actions-container">\n        <div class="title" ng-if="tdct.canInstallApp && !tdct.isChat" ng-bind="::$root.resources.strings.team_dashboard_apps_header_name_new | translate"></div>\n        <div class="title" ng-if="tdct.isChat" ng-bind="::$root.resources.strings.user_apps_header_name_new | translate"></div>\n        <div class="title" ng-if="::(!tdct.canInstallApp && !tdct.isTeamArchived)" ng-bind="::$root.resources.strings.team_dashboard_apps_header_name_noperms_new | translate"></div>\n        <div ng-if="tdct.canInstallApp" class="left-action-btns">\n            <button type="button" class="ts-btn ts-btn-fluent ts-btn-fluent-with-icon ts-btn-fluent-primary" ng-click="tdct.openAppGallery()" track-outcome="{{::$root.trackConstants.trackOutcome.nav}}" track-scenario="{{::$root.trackConstants.trackScenario.navAppStore}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.nav}}" track-name="{{::(tdct.isChat ? $root.trackConstants.trackModuleName.chatAppDashboard : $root.trackConstants.trackModuleName.teamAppDashboard)}}" track-type="{{::$root.trackConstants.trackType.nav}}" track-summary="{{::tdct.isChat ? \'Chat app dashboard - Store\' : \'Team app dashboard - Store\'}}" data-tid="td-apps-gallery">\n                <ng-include class="icon" src="::tdct.discoverButtonSrc"></ng-include>\n                <span ng-bind="::tdct.appButtonText"></span>\n            </button>\n        </div>\n    </div>\n    <div class="error" data-tid="tdAppsTab-error" ng-if="tdct.errorInfo">\n        <ng-include class="icons-input-invalid icon" src="\'svg/icons-error.html\'"></ng-include>\n        <span ng-bind-html="::tdct.errorInfo" role="alert" aria-live="assertive"></span>\n    </div>\n    <div ng-if="tdct.wait" class="td-apps-tab-busy-container">\n        <busy-animation size="medium" context="td-apps-tab"></busy-animation>\n    </div>\n\n    <div class="apps-content" ng-if="tdct.wait || tdct.appList.length > 0">\n      <div class="container-headers" ng-if="tdct.appList.length > 0">\n          <div class="td-header-name">\n              <button class="btn btn-default td-header-button icons-gray-06-triangle-fill" ng-click="tdct.sortTable(\'name\')" aria-label="{{::$root.resources.strings.td_channels_tab_header_name_aria|translate}}">\n                  <div>\x3c!-- This div is required by Firefox for flexbox --\x3e\n                      <div class="header-button-text" translate-once="{{::$root.resources.strings.td_channels_tab_header_name}}"></div>\n                      <div ng-if="tdct.sortedColumn.name === \'name\' && !tdct.sortedColumn.reverse" aria-label="{{::$root.resources.strings.td_channels_tab_header_ascending|translate}}">\n                        <ng-include class="icon triangle-icon" src="\'svg/icons-triangle-down-small.html\'"></ng-include>\n                      </div>\n                      <div ng-if="tdct.sortedColumn.name === \'name\' && tdct.sortedColumn.reverse" aria-label="{{::$root.resources.strings.td_channels_tab_header_descending|translate}}">\n                        <ng-include class="icon triangle-icon" src="\'svg/icons-triangle-up-small.html\'"></ng-include>\n                      </div>\n                  </div>\n              </button>\n          </div>\n          <div class="td-header-description">\n              <button class="btn btn-default td-header-button icons-gray-06-triangle-fill" ng-click="tdct.sortTable(\'description\')" aria-label="{{::$root.resources.strings.chat_manage_apps_header_description_aria|translate}}">\n                  <div>\x3c!-- This div is required by Firefox for flexbox --\x3e\n                      <div class="header-button-text" translate-once="{{::$root.resources.strings.td_channels_tab_header_description}}"></div>\n                      <div ng-if="tdct.sortedColumn.name === \'description\' && !tdct.sortedColumn.reverse" aria-label="{{::$root.resources.strings.td_channels_tab_header_ascending|translate}}">\n                        <ng-include class="icon triangle-icon" src="\'svg/icons-triangle-down-small.html\'"></ng-include>\n                      </div>\n                      <div ng-if="tdct.sortedColumn.name === \'description\' && tdct.sortedColumn.reverse" aria-label="{{::$root.resources.strings.td_channels_tab_header_descending|translate}}">\n                        <ng-include class="icon triangle-icon" src="\'svg/icons-triangle-up-small.html\'"></ng-include>\n                      </div>\n                  </div>\n              </button>\n          </div>\n      </div>\n    </div>\n    <div class="td-apps-tab-scrollbar-wrapper" ng-class="{\'no-apps\': tdct.appList.length === 0, \'td-apps-tab-scrollbar-wrapper-chat\': tdct.isChat}">\n      <div simple-scrollbar>\n        <div class="apps-content" ng-if="tdct.wait || tdct.appList.length > 0">\n          <ul class="td-apps-container" data-tid="tdAppsTab-apps" ng-if="tdct.appList.length > 0" scenario-end="{{ tdct.scenarioName }}">\n              <li class="td-apps" ng-repeat="app in tdct.appList track by app.id" ng-click="tdct.openAppDetails(app)" aria-label="{{app.name}} {{app.description}}" tabindex="0" data-tid="td-apps-{{::app.id}}" track-gesture="{{::$root.trackConstants.trackGesture.click}}" track-outcome="{{::$root.trackConstants.trackOutcome.openDialog}}" track-scenario="{{::$root.trackConstants.trackScenario.openAddAppDialog}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.manageApps}}" track-name="{{::$root.trackConstants.trackModuleName.manageApps}}" track-type="{{::$root.trackConstants.trackType.manageApps}}" track-summary="manage apps - open add app dialog">\n                  <div class="td-apps-name" title="{{app.name}}">\n                      <div class="td-apps-icon" aria-hidden="true" ng-style="{ \'background\': app.accentColor }">\n                          <ng-include src="app.icon" ng-if="::tdct.utilityService.useNgIncludeForIcon(app.icon)"></ng-include>\n                          <img ng-src="{{::app.icon}}" fallback-src="{{::tdct.appFallbackIcon}}" ng-if="::!tdct.utilityService.useNgIncludeForIcon(app.icon)"/>\n                      </div>\n                      <div class="td-apps-display-name" dir="auto" ng-bind-html="app.name">\n                      </div>\n                  </div>\n                  <div class="td-apps-description">\n                    <div class="td-apps-description-content" title="{{app.description}}" dir="auto">{{app.description}}</div>\n                    <div class="td-apps-upgrade-consent-notification" data-tid="td-apps-upgrade-consent-notification" title="{{::$root.resources.strings.team_dashboard_apps_upgrade_consent_notification | translate}}" ng-if="app.upgradeConsentRequired" ng-bind="::$root.resources.strings.team_dashboard_apps_upgrade_consent_notification | translate"></div>\n                  </div>\n                  <div class="td-apps-actions" ng-if="tdct.canUninstallApp && !tdct.isGuestUser">\n                      <button type="button" class="ts-btn update-button" data-tid="tdAppsTab-delete" ng-click="tdct.deleteApp($event, $index)" ng-disabled="tdct.wait" aria-label="{{::$root.resources.strings.icons_uninstall | translate}}" title="{{::$root.resources.strings.icons_uninstall | translate}}" track-gesture="{{::$root.trackConstants.trackGesture.click}}" track-outcome="{{::$root.trackConstants.trackOutcome.delete}}" track-scenario="{{::$root.trackConstants.trackScenario.removeApp}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.manageApps}}" track-name="{{::$root.trackConstants.trackModuleName.manageApps}}" track-type="{{::$root.trackConstants.trackType.manageApps}}" track-summary="manage apps - remove app">\n                          <div class="ts-sym"><ng-include src="\'svg/icons-delete.html\'"></ng-include></div>\n                      </button>\n                  </div>\n              </li>\n          </ul>\n        </div>\n      </div>\n    </div>\n\n    <div class="td-apps-noapps" data-tid="tdAppsTab-noapps" ng-if="!tdct.wait && tdct.appList.length === 0">\n        <div>\n            <div ng-if="tdct.canInstallApp">\n                <span ng-bind="::tdct.noAppsStr"></span>\n            </div>\n        </div>\n    </div>\n    <div ng-if="tdct.canInstallApp" class="td-apps-footer">\n        <div class="pull-left" ng-if="tdct.canSideloadApp">\n            <span ng-bind="::$root.resources.strings.team_dashboard_developer_footer | translate"></span>\n            <a href="{{::tdct.learnMoreUrl}}" target="_blank\\" ng-bind="::$root.resources.strings.team_dashboard_developer_footer_learn_more | translate"></a>\n        </div>\n        <div class="pull-right">\n            <div class="pull-right-container" ng-if="!tdct.isChat && tdct.canCreateOutgoingWebhook" aria-label="{{::$root.resources.strings.team_dashboard_developer_add_outgoing_webhook|translate}}">\n              <a href="javascript:void(0)" translate-once="{{::$root.resources.strings.team_dashboard_developer_add_outgoing_webhook}}" ng-click="tdct.addOutgoingWebhook()" data-tid="td-new-outgoing-webhook"></a>\n            </div>\n            <span ng-if="tdct.canSideloadApp && tdct.canCreateOutgoingWebhook && !tdct.isChat">|</span>\n            <div class="pull-right-container" aria-label="{{::$root.resources.strings.team_dashboard_developer_sideload_app_new|translate}}">\n              <a href="javascript:void(0)" ng-bind="::$root.resources.strings.team_dashboard_developer_sideload_app_new | translate" ng-if="tdct.canSideloadApp && !tdct.isGuestUser" ngf-select="tdct.sideloadApp($file)" ngf-select-disabled="tdct.wait" ng-model="tdct.file" ngf-pattern="\'.zip\'" ngf-accept="\'.zip\'" data-tid="td-new-app"></a>\n            </div>\n        </div>\n    </div>\n</div>\n'}},[2218]);